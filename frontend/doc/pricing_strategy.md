## 2. è®¢é˜…æ–¹æ¡ˆ

### 2.1 ç”¨æˆ·æ—…ç¨‹

```mermaid
graph LR
    A[æ–°ç”¨æˆ·æ³¨å†Œ] --> B[é€‰æ‹© Plus/Pro]
    B --> C[ç»‘å®šæ”¯ä»˜æ–¹å¼]
    C --> D[7å¤©å…è´¹è¯•ç”¨]
    D --> E{è¯•ç”¨æœŸå†…}
    E -->|å–æ¶ˆ| F[Free æ¯æ—¥é™é¢]
    E -->|æœªå–æ¶ˆ| G[è‡ªåŠ¨ç»­è®¢æ‰£æ¬¾]
```

### 2.2 ä¸‰æ¡£å®šä»·

> [!TIP]
> **ç­–ç•¥ B**: 7 å¤©å…è´¹è¯•ç”¨ + æ¯æ—¥é™é¢ï¼Œå¹³è¡¡ä½“éªŒä¸æˆæœ¬ã€‚

| è®¡è´¹æ–¹å¼                                                                        | ğŸ†“ Free    | â­ Plus                                                                            | ğŸ’ Pro                                                                              |
| :------------------------------------------------------------------------------ | :--------- | :--------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------- |
| **æŒ‰æœˆè®¢é˜…**                                                                    | å…è´¹       | **$9.99 /æœˆ**<br><span style="color:grey;font-size:0.9em">(åŸä»· $119.88/å¹´)</span> | **$24.99 /æœˆ**<br><span style="color:grey;font-size:0.9em">(åŸä»· $299.88/å¹´)</span> |
| **æŒ‰å¹´è®¢é˜…**<br><span style="color:#d93025;font-size:0.9em">ğŸ”¥ é™æ—¶ 6 æŠ˜</span> | -          | **$71.99 /å¹´**<br><span style="color:#188038;font-size:0.9em">(ç«‹çœ 40%)</span>    | **$179.99 /å¹´**<br><span style="color:#188038;font-size:0.9em">(ç«‹çœ 40%)</span>    |
| **æ¯æ—¥é™é¢**                                                                    | 3æ¬¡å¯¹è¯/å¤© | 20æ¬¡å¯¹è¯/å¤©                                                                        | 100æ¬¡å¯¹è¯/å¤©                                                                        |

### 2.3 7 å¤©å…è´¹è¯•ç”¨ï¼ˆå¹³å°æ ‡å‡†è®¢é˜…æ¨¡å¼ï¼‰

> [!NOTE]
> é‡‡ç”¨ **App Store / Google Play æ ‡å‡†è®¢é˜…æ¨¡å¼**ï¼Œä¸ä¸»æµåº”ç”¨ä¸€è‡´ã€‚

| é¡¹ç›®           | å†…å®¹                               |
| -------------- | ---------------------------------- |
| **è¯•ç”¨å†…å®¹**   | å®Œæ•´ Plus åŠŸèƒ½                     |
| **è¯•ç”¨æ—¶é•¿**   | 7 å¤©                               |
| **éœ€ç»‘å®šæ”¯ä»˜** | âœ… å¹³å°è¦æ±‚                        |
| **è¯•ç”¨ç»“æŸ**   | **è‡ªåŠ¨ç»­è®¢æ‰£æ¬¾**ï¼ˆç”¨æˆ·å¯æå‰å–æ¶ˆï¼‰ |
| **é¦–æœˆæ‰£æ¬¾**   | Plus $2.99 / Pro $9.99ï¼ˆé¦–æœˆä¼˜æƒ ï¼‰ |
| **è¯•ç”¨æˆæœ¬**   | ~$0.50/ç”¨æˆ·                        |
| **é¢„æœŸè½¬åŒ–ç‡** | 10-15%ï¼ˆé«˜äºæ‰‹åŠ¨è®¢é˜…ï¼‰             |

**ç”¨æˆ·æµç¨‹**:

```
æ³¨å†Œ â†’ é€‰æ‹© Plus/Pro â†’ ç»‘å®šæ”¯ä»˜ â†’ 7å¤©å…è´¹è¯•ç”¨ â†’ è‡ªåŠ¨ç»­è®¢
                                              â†“
                              ï¼ˆç”¨æˆ·å¯åœ¨è¯•ç”¨æœŸå†…éšæ—¶å–æ¶ˆï¼‰
```

### 2.4 åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ (MVP ç‰ˆæœ¬)

> [!NOTE]
> **è®¾è®¡ç†å¿µ**: é‡å¤§ç®¡é¥±ï¼Œæ¶ˆé™¤ç”¨é‡ç„¦è™‘ã€‚
>
> - **Free**: ~5 åˆ†é’Ÿ (ä½“éªŒæ ¸å¿ƒåŠŸèƒ½)
> - **Plus**: ~50 åˆ†é’Ÿ (è¶…å€¼æ—¥å¸¸ç»ƒä¹ )
> - **Pro**: ~4 å°æ—¶ (æ²‰æµ¸å¼æ¯è¯­ç¯å¢ƒ)

| åŠŸèƒ½æ¨¡å—     | åŠŸèƒ½                     | ğŸ”¥ è¯•ç”¨æœŸ  | ğŸ†“ Free | â­ Plus    | ğŸ’ Pro     |
| ------------ | ------------------------ | ---------- | ------- | ---------- | ---------- |
| **å¯¹è¯ç»ƒä¹ ** | AI å¯¹è¯æ¬¡æ•°              | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
|              | è¯­éŸ³è¾“å…¥                 | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
| **è·Ÿè¯»ç»ƒä¹ ** | å‘éŸ³è¯„ä¼°æ¬¡æ•°             | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
|              | å•è¯å‘éŸ³                 | âœ… æ— é™åˆ¶  | 10æ¬¡/å¤© | âœ… æ— é™åˆ¶  | âœ… æ— é™åˆ¶  |
|              | éŸ³é«˜å¯¹æ¯”åˆ†æ             | âœ…         | âŒ      | âœ…         | âœ…         |
| **è¯­æ³•åˆ†æ** | æ·±åº¦åˆ†ææ¬¡æ•°             | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
| **åœºæ™¯åŠŸèƒ½** | é¢„ç½®åœºæ™¯                 | å…¨éƒ¨(12ä¸ª) | 5ä¸ª     | å…¨éƒ¨(12ä¸ª) | å…¨éƒ¨(12ä¸ª) |
|              | è‡ªå®šä¹‰åœºæ™¯ï¼ˆå« AI ç”Ÿæˆï¼‰ | 10ä¸ª       | âŒ      | 10ä¸ª       | 50ä¸ª       |
| **TTS è¯­éŸ³** | AI æ¶ˆæ¯æœ—è¯»              | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |

**ğŸ’¡ ä½¿ç”¨æ—¶é•¿ä¼°ç®—**:

- Free (3æ¬¡å¯¹è¯): çº¦ **5-8 åˆ†é’Ÿ**/å¤©
- Plus (20æ¬¡å¯¹è¯): çº¦ **45-60 åˆ†é’Ÿ**/å¤©
- Pro (100æ¬¡å¯¹è¯): çº¦ **3-4 å°æ—¶**/å¤©

**ğŸ“ é¢„ç½®åœºæ™¯åˆ—è¡¨**:

| Free (5ä¸ª)    | Plus/Pro è§£é” (7ä¸ª) |
| ------------- | ------------------- |
| â˜• å’–å•¡åº—ç‚¹å• | âœˆï¸ æœºåœºå€¼æœº         |
| ğŸš• æ‰“è½¦å‡ºè¡Œ   | ğŸ¨ é…’åº—å…¥ä½         |
| ğŸ›’ è¶…å¸‚è´­ç‰©   | ğŸ—ºï¸ é—®è·¯å¯¼èˆª         |
| ğŸ½ï¸ é¤å…ç‚¹é¤   | ğŸ’¼ å·¥ä½œé¢è¯•         |
| ğŸ‘‹ è‡ªæˆ‘ä»‹ç»   | ğŸ¤ å•†åŠ¡ä¼šè®®         |
|               | ğŸ¬ ç”µå½±è®¨è®º         |
|               | ğŸ©º çœ‹åŒ»ç”Ÿ           |

**ğŸ“Œ ç¬¬äºŒç‰ˆè®¡åˆ’åŠŸèƒ½**ï¼ˆæš‚ä¸å·®å¼‚åŒ–ï¼‰:

- å¯¹è¯å†å²ä¿å­˜é™åˆ¶
- ç»ƒä¹ å†å²è®°å½•é™åˆ¶
- è¯æ±‡è¯¦è§£åˆ†çº§
- æ”¶è—è¯æ±‡å¯¼å‡º

---

## 3. å®šä»·ç­–ç•¥

### 3.1 ä»·æ ¼å®šä½

| æ–¹æ¡ˆ     | ç›®æ ‡ç”¨æˆ· | æ ¸å¿ƒå–ç‚¹                | æˆæœ¬è¦†ç›–             |
| -------- | -------- | ----------------------- | -------------------- |
| **Free** | ä½“éªŒç”¨æˆ· | ä½é—¨æ§›å°è¯•ï¼ˆ~5åˆ†é’Ÿ/å¤©ï¼‰ | é™é¢æ§åˆ¶åœ¨ $0.15/æœˆ  |
| **Plus** | æ—¥å¸¸ç»ƒä¹  | ç‰©è¶…æ‰€å€¼ï¼ˆ~1å°æ—¶/å¤©ï¼‰   | $9.99 > $1.32æˆæœ¬ âœ… |
| **Pro**  | é‡åº¦ç”¨æˆ· | å‡ ä¹æ— é™ï¼ˆ~4å°æ—¶/å¤©ï¼‰   | $24.99 > $6.6æˆæœ¬ âœ… |

### 3.2 ä»·æ ¼é”šç‚¹

- **Plus $9.99/æœˆ**: çº¦ç­‰äºä¸¤æ¯æ˜Ÿå·´å…‹ï¼Œæ—¥å‡ $0.33
- **Pro $24.99/æœˆ**: ä½äºä¸€èŠ‚å¤–æ•™è¯¾ ($30+)ï¼Œæ€§ä»·æ¯”çªå‡º
- **å¹´ä»˜ä¼˜æƒ **: äº«çº¦ 40% æŠ˜æ‰£ï¼Œæé«˜ç”¨æˆ· LTV

---

## 4. è½¬åŒ–ç­–ç•¥

### 4.1 Free â†’ Plus è§¦å‘ç‚¹

| è§¦å‘åœºæ™¯         | æç¤ºæ–‡æ¡ˆ                                                           |
| ---------------- | ------------------------------------------------------------------ |
| å¯¹è¯æ¬¡æ•°ç”¨å°½     | "Upgrade to Plus for 20 daily lessons (almost 1 hour of practice)" |
| è·Ÿè¯»è¯„ä¼°ç”¨å°½     | "Want more practice? Plus gives you 20 assessments/day"            |
| å°è¯•éŸ³é«˜å¯¹æ¯”     | "Pitch contour analysis is a Plus feature"                         |
| Pro ç”¨æˆ·æ¥è¿‘é™é¢ | "Incredible dedication! You've reached the 100 daily limit."       |

### 4.2 è®¢é˜…æ¿€åŠ±

| ç­–ç•¥         | æ—¶æœº/æ¡ä»¶     | æè¿°                                                     |
| ------------ | ------------- | -------------------------------------------------------- |
| **é¦–æœˆä¼˜æƒ ** | Day 6-7       | Plus **$2.99** / Pro **$9.99**ï¼ˆè¯•ç”¨å³å°†ç»“æŸï¼Œé™æ—¶ä¼˜æƒ ï¼‰ |
|              | Day 8-14      | Plus $4.99 / Pro $14.99ï¼ˆé”™è¿‡é™æ—¶åä»æœ‰æŠ˜æ‰£ï¼‰            |
|              | Day 15+       | åŸä»·ï¼ˆæ— ä¼˜æƒ ï¼‰                                           |
| **é‚€è¯·è¿”åˆ©** | é‚€è¯·å¥½å‹æ³¨å†Œ  | åŒæ–¹å„å¾— 7 å¤©ä¼šå‘˜                                        |
| **å­¦ä¹ æˆå°±** | è¿ç»­ 7 å¤©ç»ƒä¹  | è§£é” 10% æŠ˜æ‰£                                            |
| **å¹´ä»˜ä¼˜æƒ ** | é€‰æ‹©å¹´ä»˜      | äº« 40% æŠ˜æ‰£ï¼Œé”å®šé•¿æœŸç”¨æˆ·                                |

> [!TIP]
> **é¦–æœˆä¼˜æƒ çš„ä»·å€¼**:
>
> - è½¬åŒ–ç‡å¯æå‡ **50-100%**
> - é¦–æœˆä»˜è´¹ç”¨æˆ·ç»­è´¹ç‡**è¿œé«˜äº**æœªä»˜è´¹ç”¨æˆ·
> - æˆæœ¬çº¦ $4-5/è½¬åŒ–ç”¨æˆ·ï¼Œå¯æ¥å—

---

## 8. å®æ–½ä¼˜å…ˆçº§

| é˜¶æ®µ    | ä»»åŠ¡                        | ä¼˜å…ˆçº§ |
| ------- | --------------------------- | ------ |
| Phase 1 | ç”¨é‡ç»Ÿè®¡å’Œé™é¢ç³»ç»Ÿ          | P0     |
| Phase 1 | æ¥å…¥æ”¯ä»˜ (Apple/Google IAP) | P0     |
| Phase 2 | è®¢é˜…çŠ¶æ€ç®¡ç†                | P0     |
| Phase 2 | ä»˜è´¹å¼•å¯¼ UI                 | P1     |
| Phase 3 | A/B æµ‹è¯•æ¡†æ¶                | P2     |

---

## 9. é£é™©ä¸åº”å¯¹

| é£é™©           | åº”å¯¹ç­–ç•¥                    |
| -------------- | --------------------------- |
| API æˆæœ¬è¶…é¢„æœŸ | ç¡¬é™é¢ + åŠ¨æ€è°ƒæ•´ Free é¢åº¦ |
| ä»˜è´¹è½¬åŒ–ç‡ä½   | ä¼˜åŒ– onboarding + çªå‡ºä»·å€¼  |
| ç”¨æˆ·æµå¤±ç‡é«˜   | å­¦ä¹ æé†’ + æ‰“å¡å¥–åŠ±         |
| ç«å“ä»·æ ¼æˆ˜     | å·®å¼‚åŒ–åŠŸèƒ½ + å†…å®¹å£å’       |

---

## 10. å‰ç«¯å®ç°è®¾è®¡ (Frontend Implementation)

ä¸ºäº†æ”¯æŒ UI å±‚çš„ Paywall æµç¨‹å¼€å‘ï¼Œå»ºè®®åœ¨ `RevenueCatService` å’Œé€»è¾‘å±‚å®ç°ä»¥ä¸‹è¾…åŠ©æœºåˆ¶ã€‚

### 10.1 åŠŸèƒ½æšä¸¾å®šä¹‰ (PaidFeature)

æ˜ç¡®æ‰€æœ‰å—é™çš„åŠŸèƒ½ç‚¹ï¼Œä¾¿äºä»£ç å¼•ç”¨ã€‚

```dart
enum PaidFeature {
  // --- æ¬¡æ•°é™åˆ¶ç±» (Quota Limited) ---
  dailyConversation,    // AI å¯¹è¯ (æ¯æ—¥ä¼šè¯/æ¶ˆæ¯æ•°)
  voiceInput,           // è¯­éŸ³è¾“å…¥
  speechAssessment,     // å¥å­å‘éŸ³è¯„ä¼°
  wordPronunciation,    // å•è¯å‘éŸ³ (Free: 10/day, Plus/Pro: Unlimited)
  grammarAnalysis,      // è¯­æ³•æ·±åº¦åˆ†æ
  ttsSpeak,             // AI æ¶ˆæ¯æœ—è¯»

  // --- è®¿é—®æƒé™ç±» (Gatekeepers) ---
  pitchAnalysis,        // éŸ³é«˜å¯¹æ¯”åˆ†æ (ä»… Plus/Pro)
  customScenarios,      // è‡ªå®šä¹‰åœºæ™¯ (Free: ä¸å¯åˆ›å»º, Plus: 10ä¸ª, Pro: 50ä¸ª)
}
```

### 10.2 æƒé™åˆ¤æ–­è¾…åŠ©æ–¹æ³• (Design Logic)

å»ºè®®åœ¨ `RevenueCatService` æˆ– `SubscriptionService` ä¸­æ‰©å±•ä»¥ä¸‹æ–¹æ³•ï¼š

#### A. è·å–æƒç›Šé™é¢ (Quota Configuration)

> [!IMPORTANT]
> **Source of Truth**: é…é¢æ•°å€¼åº”ç”± **åç«¯ API** (å¦‚ `/config` æˆ– `/user/profile`) ä¸‹å‘ï¼Œä»¥æ”¯æŒåŠ¨æ€è¿è¥è°ƒæ•´ã€‚
> å‰ç«¯åº”ä¼˜å…ˆè¯»å–åç«¯é…ç½®ï¼Œä»¥ä¸‹é€»è¾‘ä»…ä½œä¸º **Default/Fallback**ã€‚

```dart
/// è·å–å½“å‰ç”¨æˆ·çš„é…é¢ï¼ˆä¼˜å…ˆè¯»å–åç«¯é…ç½®ï¼Œè¿”å› -1 ä»£è¡¨æ— é™åˆ¶ï¼‰
int getQuotaLimit(PaidFeature feature) {
  // 1. å°è¯•è¯»å–åç«¯åŠ¨æ€é…ç½®
  // int? remoteLimit = AppConfig.current.getLimit(feature, currentTier);
  // if (remoteLimit != null) return remoteLimit;

  // 2. æœ¬åœ°å…œåº•ç­–ç•¥ (Default Fallback)
  final tier = currentTier;
  switch (feature) {
    case PaidFeature.dailyConversation:
    case PaidFeature.voiceInput:
    case PaidFeature.speechAssessment:
    case PaidFeature.grammarAnalysis:
    case PaidFeature.ttsSpeak:
      if (tier == SubscriptionTier.pro) return 100;
      if (tier == SubscriptionTier.plus) return 20;
      return 3; // Free

    case PaidFeature.wordPronunciation:
      if (tier == SubscriptionTier.free) return 10;
      return -1; // Plus/Pro æ— é™åˆ¶

    case PaidFeature.customScenarios:
      if (tier == SubscriptionTier.pro) return 50;
      if (tier == SubscriptionTier.plus) return 10;
      return 0; // Free ä¸å¯åˆ›å»º

    default:
      return 0; // é»˜è®¤æ— é¢åº¦/ä¸æ”¯æŒ
  }
}
```

#### B. æ£€æŸ¥åŠŸèƒ½å¯ç”¨æ€§ (UI Helpers)

ç”¨äº UI ç»„ä»¶å†³å®šæ˜¯æ‰§è¡Œæ“ä½œã€æ˜¾ç¤ºé”å›¾æ ‡ï¼Œè¿˜æ˜¯å¼¹å‡º Paywallã€‚

```dart
/// æ£€æŸ¥æ˜¯å¦**æœ‰èµ„æ ¼**ä½¿ç”¨æŸåŠŸèƒ½ (ä¸åŒ…å«ç”¨é‡æ£€æŸ¥)
/// ä¸»è¦ç”¨äºæ˜¾ç¤º UI é”å¤´å›¾æ ‡ (ä¾‹å¦‚ Custom Scenario æŒ‰é’®åœ¨ Freeç‰ˆ ä¼šæ˜¾ç¤ºé”)
bool hasAccess(PaidFeature feature) {
   if (feature == PaidFeature.pitchAnalysis) {
     return hasPlus; // å¿…é¡»æ˜¯ Plus æˆ–ä»¥ä¸Š
   }
   if (feature == PaidFeature.customScenarios) {
     return hasPlus; // å¿…é¡»æ˜¯ Plus æˆ–ä»¥ä¸Šæ‰èƒ½åˆ›å»º
   }
   return true; // æ¬¡æ•°é™åˆ¶ç±»åŠŸèƒ½å¯¹æ‰€æœ‰äººå¼€æ”¾è®¿é—®ï¼Œåªæ˜¯é¢åº¦ä¸åŒ
}
```

### 10.3 Paywall è§¦å‘æµç¨‹ (UI Flow)

å°è£…ä¸€ä¸ªé€šç”¨çš„æ‹¦æˆªå™¨ï¼Œä¾› UI å±‚è°ƒç”¨ã€‚

```dart
/// å°è¯•æ‰§è¡Œå—é™æ“ä½œ
///
/// ç”¨äºæŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚
/// 1. æ£€æŸ¥ Feature æƒé™ (å¦‚ Free ç”¨æˆ·ç‚¹å‡»åˆ›å»ºè‡ªå®šä¹‰åœºæ™¯ -> å¼¹ Paywall)
/// 2. æ£€æŸ¥ å‰©ä½™æ¬¡æ•° (å¦‚ Free ç”¨æˆ·ç¬¬ 4 æ¬¡å‘éŸ³è¯„ä¼° -> å¼¹ Paywall)
/// 3. é€šè¿‡ -> æ‰§è¡Œ [onGranted]
void performRestrictedAction(
  BuildContext context, {
  required PaidFeature feature,
  required VoidCallback onGranted,
  VoidCallback? onPaywallCancelled,
}) {
  // 0. å¼€å‘è°ƒè¯•: å¼ºåˆ¶ Paywall
  // éœ€è¦åœ¨ Env ä¸­æ·»åŠ  forcePaywall å˜é‡
  if (Env.forcePaywall) {
    PaywallRoute.show(context, reason: "Debug: Force Paywall");
    return;
  }

  // 1. æ£€æŸ¥ç¡¬æ€§é—¨æ§› (Gatekeeping)
  if (!hasAccess(feature)) {
    // Show Paywall (Reason: Unlock Feature)
    PaywallRoute.show(context, reason: "Unlock ${feature.name}");
    return;
  }

  // 2. æ£€æŸ¥å‰©ä½™æ¬¡æ•° (Quota Check)
  //æ­¤å¤„éœ€ç»“åˆåç«¯çš„è®¡æ•°å™¨æˆ–æœ¬åœ°è®¡æ•°ç¼“å­˜
  int limit = getQuotaLimit(feature);
  int used = _usageService.getUsedCount(feature);

  if (limit != -1 && used >= limit) {
    // Show Paywall (Reason: Quota Exceeded)
    PaywallRoute.show(context, reason: "Daily limit reached");
    return;
  }

  // 3. é€šè¿‡
  onGranted();
}
```
