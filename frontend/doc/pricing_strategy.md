## 2. è®¢é˜…æ–¹æ¡ˆ

### 2.1 ç”¨æˆ·æ—…ç¨‹

```mermaid
graph LR
    A[æ–°ç”¨æˆ·æ³¨å†Œ] --> B[é€‰æ‹© Plus/Pro]
    B --> C[ç»‘å®šæ”¯ä»˜æ–¹å¼]
    C --> D[7å¤©å…è´¹è¯•ç”¨]
    D --> E{è¯•ç”¨æœŸå†…}
    E -->|å–æ¶ˆ| F[Free æ¯æ—¥é™é¢]
    E -->|æœªå–æ¶ˆ| G[è‡ªåŠ¨ç»­è®¢æ‰£æ¬¾]
```

### 2.2 ä¸‰æ¡£å®šä»·

> [!TIP]
> **ç­–ç•¥ B**: 7 å¤©å…è´¹è¯•ç”¨ + æ¯æ—¥é™é¢ï¼Œå¹³è¡¡ä½“éªŒä¸æˆæœ¬ã€‚

| è®¡è´¹æ–¹å¼                                                                        | ğŸ†“ Free    | â­ Plus                                                                            | ğŸ’ Pro                                                                              |
| :------------------------------------------------------------------------------ | :--------- | :--------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------- |
| **æŒ‰æœˆè®¢é˜…**                                                                    | å…è´¹       | **$9.99 /æœˆ**<br><span style="color:grey;font-size:0.9em">(åŸä»· $119.88/å¹´)</span> | **$24.99 /æœˆ**<br><span style="color:grey;font-size:0.9em">(åŸä»· $299.88/å¹´)</span> |
| **æŒ‰å¹´è®¢é˜…**<br><span style="color:#d93025;font-size:0.9em">ğŸ”¥ é™æ—¶ 6 æŠ˜</span> | -          | **$71.99 /å¹´**<br><span style="color:#188038;font-size:0.9em">(ç«‹çœ 40%)</span>    | **$179.99 /å¹´**<br><span style="color:#188038;font-size:0.9em">(ç«‹çœ 40%)</span>    |
| **æ¯æ—¥é™é¢**                                                                    | 3æ¬¡å¯¹è¯/å¤© | 20æ¬¡å¯¹è¯/å¤©                                                                        | 100æ¬¡å¯¹è¯/å¤©                                                                        |

### 2.3 7 å¤©å…è´¹è¯•ç”¨ï¼ˆå¹³å°æ ‡å‡†è®¢é˜…æ¨¡å¼ï¼‰

> [!NOTE]
> é‡‡ç”¨ **App Store / Google Play æ ‡å‡†è®¢é˜…æ¨¡å¼**ï¼Œä¸ä¸»æµåº”ç”¨ä¸€è‡´ã€‚

| é¡¹ç›®           | å†…å®¹                               |
| -------------- | ---------------------------------- |
| **è¯•ç”¨å†…å®¹**   | å®Œæ•´ Plus åŠŸèƒ½                     |
| **è¯•ç”¨æ—¶é•¿**   | 7 å¤©                               |
| **éœ€ç»‘å®šæ”¯ä»˜** | âœ… å¹³å°è¦æ±‚                        |
| **è¯•ç”¨ç»“æŸ**   | **è‡ªåŠ¨ç»­è®¢æ‰£æ¬¾**ï¼ˆç”¨æˆ·å¯æå‰å–æ¶ˆï¼‰ |
| **é¦–æœˆæ‰£æ¬¾**   | Plus $2.99 / Pro $9.99ï¼ˆé¦–æœˆä¼˜æƒ ï¼‰ |
| **è¯•ç”¨æˆæœ¬**   | ~$0.50/ç”¨æˆ·                        |
| **é¢„æœŸè½¬åŒ–ç‡** | 10-15%ï¼ˆé«˜äºæ‰‹åŠ¨è®¢é˜…ï¼‰             |

**ç”¨æˆ·æµç¨‹**:

```
æ³¨å†Œ â†’ é€‰æ‹© Plus/Pro â†’ ç»‘å®šæ”¯ä»˜ â†’ 7å¤©å…è´¹è¯•ç”¨ â†’ è‡ªåŠ¨ç»­è®¢
                                              â†“
                              ï¼ˆç”¨æˆ·å¯åœ¨è¯•ç”¨æœŸå†…éšæ—¶å–æ¶ˆï¼‰
```

### 2.4 åŠŸèƒ½å¯¹æ¯”çŸ©é˜µ (MVP ç‰ˆæœ¬)

> [!NOTE]
> **è®¾è®¡ç†å¿µ**: é‡å¤§ç®¡é¥±ï¼Œæ¶ˆé™¤ç”¨é‡ç„¦è™‘ã€‚
>
> - **Free**: ~5 åˆ†é’Ÿ (ä½“éªŒæ ¸å¿ƒåŠŸèƒ½)
> - **Plus**: ~50 åˆ†é’Ÿ (è¶…å€¼æ—¥å¸¸ç»ƒä¹ )
> - **Pro**: ~4 å°æ—¶ (æ²‰æµ¸å¼æ¯è¯­ç¯å¢ƒ)

| åŠŸèƒ½æ¨¡å—     | åŠŸèƒ½                     | ğŸ”¥ è¯•ç”¨æœŸ  | ğŸ†“ Free | â­ Plus    | ğŸ’ Pro     |
| ------------ | ------------------------ | ---------- | ------- | ---------- | ---------- |
| **å¯¹è¯ç»ƒä¹ ** | AI å¯¹è¯æ¬¡æ•°              | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
|              | è¯­éŸ³è¾“å…¥                 | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
| **è·Ÿè¯»ç»ƒä¹ ** | å‘éŸ³è¯„ä¼°æ¬¡æ•°             | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
|              | å•è¯å‘éŸ³                 | âœ… æ— é™åˆ¶  | 10æ¬¡/å¤© | âœ… æ— é™åˆ¶  | âœ… æ— é™åˆ¶  |
|              | éŸ³é«˜å¯¹æ¯”åˆ†æ             | âœ…         | âŒ      | âœ…         | âœ…         |
| **è¯­æ³•åˆ†æ** | æ·±åº¦åˆ†ææ¬¡æ•°             | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |
| **åœºæ™¯åŠŸèƒ½** | é¢„ç½®åœºæ™¯                 | å…¨éƒ¨(12ä¸ª) | 5ä¸ª     | å…¨éƒ¨(12ä¸ª) | å…¨éƒ¨(12ä¸ª) |
|              | è‡ªå®šä¹‰åœºæ™¯ï¼ˆå« AI ç”Ÿæˆï¼‰ | 10ä¸ª       | âŒ      | 10ä¸ª       | 50ä¸ª       |
| **TTS è¯­éŸ³** | AI æ¶ˆæ¯æœ—è¯»              | 20æ¬¡/å¤©    | 3æ¬¡/å¤©  | 20æ¬¡/å¤©    | 100æ¬¡/å¤©   |

**ğŸ’¡ ä½¿ç”¨æ—¶é•¿ä¼°ç®—**:

- Free (3æ¬¡å¯¹è¯): çº¦ **5-8 åˆ†é’Ÿ**/å¤©
- Plus (20æ¬¡å¯¹è¯): çº¦ **45-60 åˆ†é’Ÿ**/å¤©
- Pro (100æ¬¡å¯¹è¯): çº¦ **3-4 å°æ—¶**/å¤©

**ğŸ“ é¢„ç½®åœºæ™¯åˆ—è¡¨**:

| Free (5ä¸ª)    | Plus/Pro è§£é” (7ä¸ª) |
| ------------- | ------------------- |
| â˜• å’–å•¡åº—ç‚¹å• | âœˆï¸ æœºåœºå€¼æœº         |
| ğŸš• æ‰“è½¦å‡ºè¡Œ   | ğŸ¨ é…’åº—å…¥ä½         |
| ğŸ›’ è¶…å¸‚è´­ç‰©   | ğŸ—ºï¸ é—®è·¯å¯¼èˆª         |
| ğŸ½ï¸ é¤å…ç‚¹é¤   | ğŸ’¼ å·¥ä½œé¢è¯•         |
| ğŸ‘‹ è‡ªæˆ‘ä»‹ç»   | ğŸ¤ å•†åŠ¡ä¼šè®®         |
|               | ğŸ¬ ç”µå½±è®¨è®º         |
|               | ğŸ©º çœ‹åŒ»ç”Ÿ           |

**ğŸ“Œ ç¬¬äºŒç‰ˆè®¡åˆ’åŠŸèƒ½**ï¼ˆæš‚ä¸å·®å¼‚åŒ–ï¼‰:

- å¯¹è¯å†å²ä¿å­˜é™åˆ¶
- ç»ƒä¹ å†å²è®°å½•é™åˆ¶
- è¯æ±‡è¯¦è§£åˆ†çº§
- æ”¶è—è¯æ±‡å¯¼å‡º

---

## 3. å®šä»·ç­–ç•¥

### 3.1 ä»·æ ¼å®šä½

| æ–¹æ¡ˆ     | ç›®æ ‡ç”¨æˆ· | æ ¸å¿ƒå–ç‚¹                | æˆæœ¬è¦†ç›–             |
| -------- | -------- | ----------------------- | -------------------- |
| **Free** | ä½“éªŒç”¨æˆ· | ä½é—¨æ§›å°è¯•ï¼ˆ~5åˆ†é’Ÿ/å¤©ï¼‰ | é™é¢æ§åˆ¶åœ¨ $0.15/æœˆ  |
| **Plus** | æ—¥å¸¸ç»ƒä¹  | ç‰©è¶…æ‰€å€¼ï¼ˆ~1å°æ—¶/å¤©ï¼‰   | $9.99 > $1.32æˆæœ¬ âœ… |
| **Pro**  | é‡åº¦ç”¨æˆ· | å‡ ä¹æ— é™ï¼ˆ~4å°æ—¶/å¤©ï¼‰   | $24.99 > $6.6æˆæœ¬ âœ… |

### 3.2 ä»·æ ¼é”šç‚¹

- **Plus $9.99/æœˆ**: çº¦ç­‰äºä¸¤æ¯æ˜Ÿå·´å…‹ï¼Œæ—¥å‡ $0.33
- **Pro $24.99/æœˆ**: ä½äºä¸€èŠ‚å¤–æ•™è¯¾ ($30+)ï¼Œæ€§ä»·æ¯”çªå‡º
- **å¹´ä»˜ä¼˜æƒ **: äº«çº¦ 40% æŠ˜æ‰£ï¼Œæé«˜ç”¨æˆ· LTV

---

## 4. è½¬åŒ–ç­–ç•¥

### 4.1 Free â†’ Plus è§¦å‘ç‚¹

| è§¦å‘åœºæ™¯         | æç¤ºæ–‡æ¡ˆ                                                           |
| ---------------- | ------------------------------------------------------------------ |
| å¯¹è¯æ¬¡æ•°ç”¨å°½     | "Upgrade to Plus for 20 daily lessons (almost 1 hour of practice)" |
| è·Ÿè¯»è¯„ä¼°ç”¨å°½     | "Want more practice? Plus gives you 20 assessments/day"            |
| å°è¯•éŸ³é«˜å¯¹æ¯”     | "Pitch contour analysis is a Plus feature"                         |
| Pro ç”¨æˆ·æ¥è¿‘é™é¢ | "Incredible dedication! You've reached the 100 daily limit."       |

### 4.2 è®¢é˜…æ¿€åŠ±

| ç­–ç•¥         | æ—¶æœº/æ¡ä»¶     | æè¿°                                                     |
| ------------ | ------------- | -------------------------------------------------------- |
| **é¦–æœˆä¼˜æƒ ** | Day 6-7       | Plus **$2.99** / Pro **$9.99**ï¼ˆè¯•ç”¨å³å°†ç»“æŸï¼Œé™æ—¶ä¼˜æƒ ï¼‰ |
|              | Day 8-14      | Plus $4.99 / Pro $14.99ï¼ˆé”™è¿‡é™æ—¶åä»æœ‰æŠ˜æ‰£ï¼‰            |
|              | Day 15+       | åŸä»·ï¼ˆæ— ä¼˜æƒ ï¼‰                                           |
| **é‚€è¯·è¿”åˆ©** | é‚€è¯·å¥½å‹æ³¨å†Œ  | åŒæ–¹å„å¾— 7 å¤©ä¼šå‘˜                                        |
| **å­¦ä¹ æˆå°±** | è¿ç»­ 7 å¤©ç»ƒä¹  | è§£é” 10% æŠ˜æ‰£                                            |
| **å¹´ä»˜ä¼˜æƒ ** | é€‰æ‹©å¹´ä»˜      | äº« 40% æŠ˜æ‰£ï¼Œé”å®šé•¿æœŸç”¨æˆ·                                |

> [!TIP]
> **é¦–æœˆä¼˜æƒ çš„ä»·å€¼**:
>
> - è½¬åŒ–ç‡å¯æå‡ **50-100%**
> - é¦–æœˆä»˜è´¹ç”¨æˆ·ç»­è´¹ç‡**è¿œé«˜äº**æœªä»˜è´¹ç”¨æˆ·
> - æˆæœ¬çº¦ $4-5/è½¬åŒ–ç”¨æˆ·ï¼Œå¯æ¥å—

---

## 5. ç«å“åˆ†æ (Competitor Analysis)

### 5.1 ä¸»è¦ç«å“ï¼šSpeak

**Speak** æ˜¯ç›®å‰ AI å£è¯­é¢†åŸŸçš„å¤´éƒ¨äº§å“ï¼Œä¸»æ‰“ AI æ¨¡æ‹ŸçœŸäººå¯¹è¯ã€‚

| è®¢é˜…æ–¹æ¡ˆ | ä»·æ ¼ (æœˆä»˜) | ä»·æ ¼ (å¹´ä»˜) | æ ¸å¿ƒåŠŸèƒ½ä¸é™åˆ¶ |
| :--- | :--- | :--- | :--- |
| **Free / Trial** | å…è´¹ | - | - 7å¤©å…è´¹è¯•ç”¨ (éœ€ç»‘å®šæ”¯ä»˜)<br>- åŸºç¡€è¯¾ç¨‹è¯•å¬<br>- æä½é™é¢çš„å¯¹è¯ä½“éªŒ |
| **Premium** | **$19.99/mo** | **$119.99/yr**<br>(~$10/mo) | - âœ… è§£é”æ‰€æœ‰æ ¸å¿ƒè¯¾ç¨‹ (Core Lessons)<br>- âœ… AI å¯¼å¸ˆ (åŸºç¡€ç‰ˆ)<br>- âœ… è§’è‰²æ‰®æ¼” (Roleplay) & è‡ªç”±å¯¹è¯<br>- âœ… å®æ—¶è¯­éŸ³çº æ­£<br>- âš ï¸ **é™åˆ¶**: è‡ªå®šä¹‰ AI è¯¾ç¨‹ (Custom Lessons) æœ‰é¢åº¦é™åˆ¶ |
| **Premium Plus** | **$29.99/mo** | **$179.99/yr**<br>(~$15/mo) | - âœ… åŒ…å« Premium æ‰€æœ‰åŠŸèƒ½<br>- ğŸ”¥ **æ— é™é‡** è‡ªå®šä¹‰ AI è¯¾ç¨‹<br>- ğŸ”¥ ä¸ªæ€§åŒ–å¤ä¹  (Made for You)<br>- ğŸ”¥ è¿›é˜¶ AI å¯¼å¸ˆ (æ›´æ·±åº¦åé¦ˆ)<br>- ğŸ”¥ ä¸“é¡¹æŒ‘æˆ˜ (30-day challenge) |

**ğŸ’¡ æˆ‘ä»¬çš„ç«äº‰ç­–ç•¥**:

*   **ä»·æ ¼ä¼˜åŠ¿**:
    *   **Plus ($9.99)** vs Speak Premium ($19.99): æˆ‘ä»¬çš„å…¥é—¨ç‰ˆä»…ä¸ºç«å“ **åŠä»·**ï¼Œä½†æä¾›ç±»ä¼¼çš„æ—¥å¸¸å¯¹è¯ç»ƒä¹ é‡ (20æ¬¡/å¤© â‰ˆ 45-60åˆ†é’Ÿ)ã€‚
    *   **Pro ($24.99)** vs Speak Premium Plus ($29.99): æˆ‘ä»¬çš„ä¸“ä¸šç‰ˆæ›´ä¾¿å®œï¼ŒåŒæ ·ä¸»æ‰“é«˜é¢‘æ¬¡/æ·±åº¦ç»ƒä¹ ã€‚
*   **å·®å¼‚åŒ–**:
    *   Speak å¼ºåœ¨**è¯¾ç¨‹ä½“ç³»** (Systematic Lessons)ã€‚
    *   TriTalk å¼ºåœ¨**åœºæ™¯æ¨¡æ‹Ÿ** (Scenario-based) å’Œ **é›…æ€/è€ƒè¯•åº”è¯•** (é’ˆå¯¹æ€§å¼º)ã€‚

---

## 8. å®æ–½ä¼˜å…ˆçº§

| é˜¶æ®µ    | ä»»åŠ¡                        | ä¼˜å…ˆçº§ |
| ------- | --------------------------- | ------ |
| Phase 1 | ç”¨é‡ç»Ÿè®¡å’Œé™é¢ç³»ç»Ÿ          | P0     |
| Phase 1 | æ¥å…¥æ”¯ä»˜ (Apple/Google IAP) | P0     |
| Phase 2 | è®¢é˜…çŠ¶æ€ç®¡ç†                | P0     |
| Phase 2 | ä»˜è´¹å¼•å¯¼ UI                 | P1     |
| Phase 3 | A/B æµ‹è¯•æ¡†æ¶                | P2     |

---

## 9. é£é™©ä¸åº”å¯¹

| é£é™©           | åº”å¯¹ç­–ç•¥                    |
| -------------- | --------------------------- |
| API æˆæœ¬è¶…é¢„æœŸ | ç¡¬é™é¢ + åŠ¨æ€è°ƒæ•´ Free é¢åº¦ |
| ä»˜è´¹è½¬åŒ–ç‡ä½   | ä¼˜åŒ– onboarding + çªå‡ºä»·å€¼  |
| ç”¨æˆ·æµå¤±ç‡é«˜   | å­¦ä¹ æé†’ + æ‰“å¡å¥–åŠ±         |
| ç«å“ä»·æ ¼æˆ˜     | å·®å¼‚åŒ–åŠŸèƒ½ + å†…å®¹å£å’       |

---

## 10. å‰ç«¯å®ç° (Frontend Implementation)

å·²åœ¨ `frontend/lib/features/subscription/` ä¸‹å®ç°äº†å®Œæ•´çš„ä»˜è´¹é—¨æ§›æ§åˆ¶æœºåˆ¶ã€‚

### 10.1 æ ¸å¿ƒç»„ä»¶ ï¼ˆå·²å®Œæˆï¼‰

- **`FeatureGate`** (`presentation/feature_gate.dart`): å•ä¾‹æ‹¦æˆªå™¨ï¼Œç»Ÿä¸€å¤„ç†æƒé™æ£€æŸ¥å’Œ Paywall è§¦å‘ã€‚
- **`UsageService`** (`domain/services/usage_service.dart`): ç”¨é‡è¿½è¸ªæ¥å£ï¼Œç”¨äºç»Ÿè®¡æ¯æ—¥ä½¿ç”¨æ¬¡æ•°ã€‚
- **`PaywallRoute`** (`presentation/paywall_route.dart`): è·¯ç”±è¾…åŠ©ç±»ã€‚

### 10.2 åŠŸèƒ½æšä¸¾ (PaidFeature) ï¼ˆå·²å®Œæˆï¼‰

ä½äº `domain/models/paid_feature.dart`:

```dart
enum PaidFeature {
  // --- æ¬¡æ•°é™åˆ¶ç±» (Quota Limited) ---
  dailyConversation,    // AI å¯¹è¯
  voiceInput,           // è¯­éŸ³è¾“å…¥
  speechAssessment,     // å‘éŸ³è¯„ä¼°
  wordPronunciation,    // å•è¯å‘éŸ³
  grammarAnalysis,      // è¯­æ³•åˆ†æ
  ttsSpeak,             // TTS æœ—è¯»

  // --- è®¿é—®æƒé™ç±» (Gatekeepers) ---
  pitchAnalysis,        // éŸ³é«˜åˆ†æ (ä»… Plus/Pro)
  customScenarios,      // è‡ªå®šä¹‰åœºæ™¯ (Freeä¸å¯åˆ›å»º)
}
```

### 10.3 ä½¿ç”¨æ–¹æ³• (Usage)

`FeatureGate().performWithFeatureCheck` æ”¯æŒä¸¤ç§è°ƒç”¨æ–¹å¼ï¼š**å›è°ƒæ¨¡å¼**ï¼ˆé€‚åˆåŒæ­¥ UI æ“ä½œï¼‰å’Œ **Await æ¨¡å¼**ï¼ˆé€‚åˆå¼‚æ­¥ API è°ƒç”¨ï¼‰ã€‚

**æ–¹å¼ 1ï¼šå›è°ƒæ¨¡å¼ (Callback Style)** - é€‚åˆå¯¼èˆªã€ç®€å•çš„ UI æ›´æ–°

```dart
// ç¤ºä¾‹ï¼šç‚¹å‡»"åˆ›å»ºåœºæ™¯"æŒ‰é’®
FeatureGate().performWithFeatureCheck(
  context,
  feature: PaidFeature.customScenarios,
  onGranted: () {
    // âœ… æƒé™éªŒè¯é€šè¿‡ï¼Œæ‰§è¡ŒåŸæœ‰é€»è¾‘
    Navigator.pushNamed(context, '/create_scenario');
  },
);
```

**æ–¹å¼ 2ï¼šAwait æ¨¡å¼ (Async/Await Style)** - é€‚åˆå¼‚æ­¥æ“ä½œ (å¦‚å‘é€è¯·æ±‚)

```dart
// ç¤ºä¾‹ï¼šå‘é€èŠå¤©æ¶ˆæ¯
void _sendMessage() async {
  // 1. å…ˆæ£€æŸ¥æƒé™
  final granted = await FeatureGate().performWithFeatureCheck(
    context,
    feature: PaidFeature.dailyConversation,
  );

  // 2. æ ¹æ®ç»“æœæ‰§è¡Œå¼‚æ­¥é€»è¾‘
  if (granted) {
    await chatNotifier.sendChat(text);
  }
}
```

### 10.4 å†…éƒ¨é€»è¾‘æµç¨‹

æ–¹æ³•ç­¾åï¼š`Future<bool> performWithFeatureCheck(...)`

1. **æ£€æŸ¥ Debug æ ‡è®°**: è‹¥ `Env.forcePaywall` ä¸º trueï¼Œå¼ºåˆ¶å¼¹çª—ï¼Œè¿”å› `false`ã€‚
2. **æ£€æŸ¥ç¡¬æ€§é—¨æ§› (Gatekeeping)**:
   - ä¾‹å¦‚ `pitchAnalysis` å¿…é¡»æ˜¯ Plus æˆ– Pro ç”¨æˆ·ã€‚
   - ä¸æ»¡è¶³ -> å¼¹å‡º Paywallã€‚
3. **æ£€æŸ¥æ¯æ—¥é™é¢ (Quota Check)**:
   - è¯»å– `UsageService` è·å–ä»Šæ—¥å·²ç”¨æ¬¡æ•°ã€‚
   - å¯¹æ¯”å½“å‰ç­‰çº§çš„é…é¢ (Free/Plus/Pro)ã€‚
   - å·²è¶…é™ -> å¼¹å‡º Paywallã€‚
4. **ç»“æœå¤„ç†**:
   - **é€šè¿‡/å·²ä»˜è´¹** -> è°ƒç”¨ `onGranted` (å¦‚æœ‰)ï¼Œå¹¶è¿”å› `true`ã€‚
   - **å–æ¶ˆ/æœªä»˜è´¹** -> è°ƒç”¨ `onPaywallCancelled` (å¦‚æœ‰)ï¼Œå¹¶è¿”å› `false`ã€‚

### 10.5 é…é¢é…ç½® (FeatureGate)

ç›®å‰é…é¢ç­–ç•¥ç¡¬ç¼–ç åœ¨ `FeatureGate.getQuotaLimit` ä¸­ï¼Œä½œä¸ºæœ¬åœ°å…œåº•ã€‚

> **æ³¨æ„**: `UsageServiceImpl` ç›®å‰ä½¿ç”¨å†…å­˜ç¼“å­˜ (`_usageCounts`)ï¼Œé‡å¯ App ä¼šé‡ç½®ã€‚
> **TODO**: éœ€è¦å¯¹æ¥ `SharedPreferences` æˆ–åç«¯ API å®ç°æŒä¹…åŒ–å’Œè·¨ç«¯åŒæ­¥ã€‚

```dart
// ä¼ªä»£ç é€»è¾‘
int getQuotaLimit(PaidFeature feature) {
  final tier = RevenueCatService().currentTier;
  // ... æ ¹æ® Tier è¿”å› 3, 20, 100 æˆ– -1 (æ— é™)
}
```

### 10.6 Integration Points (Checklist) (å·²å®Œæˆ)

> [!IMPT]
> ä»¥ä¸‹æ˜¯æ‰€æœ‰éœ€è¦æ¥å…¥ `FeatureGate().performWithFeatureCheck` çš„ä»£ç ä½ç½®ã€‚

| Feature Enum          | Core Component | File Path                                                      | Method / Trigger                   | Recommended Style      | Notes                                      |
| :-------------------- | :------------- | :------------------------------------------------------------- | :--------------------------------- | :--------------------- | :----------------------------------------- |
| **customScenarios**   | Home Screen    | `features/home/presentation/pages/home_screen.dart`            | `FloatingActionButton.onPressed`   | **Style 1 (Callback)** | ç‚¹å‡»"+"å·åˆ›å»ºæ–°åœºæ™¯å‰æ£€æŸ¥ (Navigation)     |
| **dailyConversation** | Chat Screen    | `features/chat/presentation/pages/chat_screen.dart`            | `_sendMessage`                     | **Style 2 (Await)**    | å‘é€æ–‡æœ¬æ¶ˆæ¯å‰æ£€æŸ¥ (Async API)             |
| **voiceInput**        | Chat Screen    | `features/chat/presentation/pages/chat_screen.dart`            | `_startVoiceRecording`             | **Style 2 (Await)**    | ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³å‰æ£€æŸ¥ (Async Logic)     |
| **speechAssessment**  | Chat Screen    | `features/chat/presentation/pages/chat_screen.dart`            | `_handleUserMessageAnalysis`       | **Style 2 (Await)**    | ç‚¹å‡»"Analyze" (Voice Msg) å‰æ£€æŸ¥ (API)     |
| **speechAssessment**  | Shadowing      | `features/study/presentation/widgets/shadowing_sheet.dart`     | `_stopRecording` / `_analyzeAudio` | **Style 2 (Await)**    | è·Ÿè¯»å½•éŸ³ç»“æŸåˆ†æå‰æ£€æŸ¥ (API)               |
| **grammarAnalysis**   | Chat Screen    | `features/chat/presentation/pages/chat_screen.dart`            | `_handleUserMessageAnalysis`       | **Style 2 (Await)**    | ç‚¹å‡»"Analyze" (Text Msg) å‰æ£€æŸ¥ (API)      |
| **grammarAnalysis**   | Chat Screen    | `features/chat/presentation/pages/chat_screen.dart`            | `_handleAnalyze`                   | **Style 2 (Await)**    | ç‚¹å‡» AI æ¶ˆæ¯çš„ "Analyze" å‰æ£€æŸ¥ (API)      |
| **grammarAnalysis**   | Chat Screen    | `features/chat/presentation/pages/chat_screen.dart`            | `_optimizeMessage`                 | **Style 2 (Await)**    | ç‚¹å‡»"é­”æ³•æ£’" (AI Rewrite) å‰æ£€æŸ¥ (API)     |
| **ttsSpeak**          | Chat Bubble    | `features/chat/presentation/widgets/chat_bubble.dart`          | `_playPauseVoice` or Speaker Icon  | **Style 2 (Await)**    | ç‚¹å‡»æ¶ˆæ¯æœ—è¯» (Speaker Icon) å‰æ£€æŸ¥ (Audio) |
| **ttsSpeak**          | Shadowing      | `features/study/presentation/widgets/shadowing_sheet.dart`     | `_playTextToSpeech`                | **Style 2 (Await)**    | ç‚¹å‡»æ’­æ”¾åŸå¥éŸ³é¢‘å‰æ£€æŸ¥ (Audio)             |
| **wordPronunciation** | Vocab List     | `features/study/presentation/widgets/vocab_list_widget.dart`   | `_playWordPronunciation`           | **Style 2 (Await)**    | ç‚¹å‡»å•è¯æ’­æ”¾å‘éŸ³æ—¶æ£€æŸ¥ (Audio)             |
| **wordPronunciation** | Feedback       | `features/chat/presentation/widgets/voice_feedback_sheet.dart` | `_playWordPronunciation`           | **Style 2 (Await)**    | ç‚¹å‡»å•è¯æ’­æ”¾å‘éŸ³æ—¶æ£€æŸ¥ (Audio)             |
| **wordPronunciation** | Analysis       | `features/study/presentation/widgets/analysis_sheet.dart`      | `_playWordPronunciation`           | **Style 2 (Await)**    | ç‚¹å‡»å•è¯æ’­æ”¾å‘éŸ³æ—¶æ£€æŸ¥ (Audio)             |
| **wordPronunciation** | Favorites      | `features/profile/presentation/widgets/favorites_sheet.dart`   | `_playWordPronunciation`           | **Style 2 (Await)**    | ç‚¹å‡»å•è¯æ’­æ”¾å‘éŸ³æ—¶æ£€æŸ¥ (Audio)             |
| **pitchAnalysis**     | Feedback       | `features/chat/presentation/widgets/voice_feedback_sheet.dart` | `_buildIntonation` (UI)            | **Style 1 (Callback)** | è§£é”ååˆ·æ–° UI (setState)                   |

**Reference Styles**:

```dart
// Style 1: Callback (Synchronous UI actions like Navigation)
FeatureGate().performWithFeatureCheck(
  context,
  feature: PaidFeature.customScenarios,
  onGranted: () => Navigator.pushNamed(context, '...'),
);

// Style 2: Await (Async API calls)
if (await FeatureGate().performWithFeatureCheck(context, feature: ...)) {
  await chatNotifier.sendChat(text);
}
```
