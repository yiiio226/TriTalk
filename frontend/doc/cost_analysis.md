# TriTalk 成本分析 (Cost Analysis)

**中文** | [English](cost_analysis_en.md)

> 📊 本文档详细分析 TriTalk 项目各服务组件的运营成本，帮助评估和优化项目开支。

---

## 📊 综合成本汇总

> 💡 **快速概览**：按 DAU 规模估算的月度总成本和人均成本。

| DAU 规模 | Cloudflare | Supabase | GCP TTS         | Azure Speech | **月总成本**          | **人均成本/月** |
| -------- | ---------- | -------- | --------------- | ------------ | --------------------- | --------------- |
| 开发阶段 | $0         | $0       | $0 (Free Tier)  | $0 (测试)    | **$0**                | -               |
| 100 DAU  | $0         | $0       | $0 (Free Tier)  | ~$165        | **~$165/月**          | **~$1.65**      |
| 1000 DAU | $5         | $0-25    | $750-1,500\*    | $1,650       | **$2,400-3,200/月**   | **$2.4-3.2**    |
| 10K DAU  | $11        | $25      | $7,500-15,000\* | $16,500      | **$24,000-31,500/月** | **$2.4-3.15**   |

> \* TTS 成本假设 50% 缓存命中率；实际通过优化缓存策略可进一步降低。
>
> 📉 **规模效应**：随着用户规模增长，人均成本基本稳定在 **$2.4-3.2/月**，主要由 AI 服务（TTS + 发音评估）驱动。

---

## 📋 服务概览

TriTalk 采用现代无服务器架构，主要使用以下云服务：

| 服务              | 用途                   | 状态        |
| ----------------- | ---------------------- | ----------- |
| Cloudflare Worker | 边缘计算、AI 网关/代理 | ✅ 使用     |
| Cloudflare R2     | 对象存储               | ⏸️ 暂未使用 |
| Supabase          | 数据库 + 认证          | ✅ 使用     |
| GCP Vertex AI     | Gemini TTS 语音合成    | ✅ 使用     |
| Azure Speech      | 发音评估               | ✅ 使用     |

---

## 💰 各服务成本详解

### 1. Cloudflare Worker

> 边缘函数运行环境，处理 AI 请求代理、提示词工程等

#### 定价模式

| 计划 | 请求量            | 费用             |
| ---- | ----------------- | ---------------- |
| Free | 100,000 请求/天   | **$0**           |
| Paid | 前 1000 万请求/月 | **$5/月** 起     |
| Paid | 超出部分          | $0.30 / 百万请求 |

#### 成本估算

| 场景                | 假设参数                           | 成本       |
| ------------------- | ---------------------------------- | ---------- |
| 1000 DAU (轻度使用) | 每人每天 50 请求 = 150 万请求/月   | **$5/月**  |
| 1000 DAU (重度使用) | 每人每天 200 请求 = 600 万请求/月  | **$5/月**  |
| 10,000 DAU          | 每人每天 100 请求 = 3000 万请求/月 | **$11/月** |

> 💡 **结论**: Cloudflare Worker 成本极低，即使达到 10K DAU 月费也仅约 $11。

---

### 2. Cloudflare R2 Storage

> 对象存储，可用于音频文件、用户资源等静态资源存储

#### 定价模式

| 资源     | 免费额度          | 超出费用         |
| -------- | ----------------- | ---------------- |
| 存储     | 10 GB / 月        | $0.015 / GB / 月 |
| A 类操作 | 100 万次 / 月     | $4.50 / 百万次   |
| B 类操作 | 1000 万次 / 月    | $0.36 / 百万次   |
| 出口流量 | 免费 (无出口费用) | **$0**           |

#### 当前状态

⏸️ **暂未使用** - 目前音频缓存在客户端本地，无需 R2 存储。

#### 未来预估 (如启用)

| 场景       | 假设参数                 | 成本                   |
| ---------- | ------------------------ | ---------------------- |
| 1000 DAU   | 存储 5GB + 50 万次读取   | **$0/月** (免费额度内) |
| 10,000 DAU | 存储 50GB + 500 万次读取 | **~$1/月**             |

> 💡 **结论**: R2 几乎免费，适合未来扩展使用。

---

### 3. Supabase

> PostgreSQL 数据库 + 认证服务 + 实时订阅

#### 定价模式

| 计划 | 数据库 | 存储   | 带宽   | 费用        |
| ---- | ------ | ------ | ------ | ----------- |
| Free | 500 MB | 1 GB   | 2 GB   | **$0**      |
| Pro  | 8 GB   | 100 GB | 250 GB | **$25/月**  |
| Team | 无限制 | 无限制 | 无限制 | **$599/月** |

#### 免费计划限制

| 资源                | 限制         |
| ------------------- | ------------ |
| 数据库大小          | 500 MB       |
| 文件存储            | 1 GB         |
| 带宽                | 2 GB / 月    |
| 边缘函数调用        | 50 万次 / 月 |
| 每日活跃用户 (Auth) | 无限制       |

#### 成本估算

| 场景          | 数据库预估大小 | 推荐计划   | 成本         |
| ------------- | -------------- | ---------- | ------------ |
| 开发/测试阶段 | < 100 MB       | Free       | **$0/月**    |
| 1000 DAU      | ~200 MB        | Free / Pro | **$0-25/月** |
| 10,000 DAU    | ~1-2 GB        | Pro        | **$25/月**   |

> 💡 **结论**: 早期阶段 Free 计划足够，用户增长后升级到 Pro ($25/月)。

---

### 4. GCP Vertex AI - Gemini TTS

> 使用 Gemini 2.5 Flash Preview TTS 进行语音合成

#### 定价模式

| 项目   | Free Tier      | Paid Tier          |
| ------ | -------------- | ------------------ |
| Input  | Free of charge | $0.50 / 1M tokens  |
| Output | Free of charge | $10.00 / 1M tokens |

#### Token 计费规则 (官方)

- **Input**: $0.50 / 1M text tokens
- **Output**: $10.00 / 1M **audio tokens**
- **换算**: **1 秒音频 = 25 tokens**
- **单价**: 约 **$0.015 / 分钟** ($0.90 / 小时)

#### 成本估算

##### 对话/跟读场景 (长句子 TTS)

| 场景                       | 假设参数                          | 计算过程                        | 成本                     |
| -------------------------- | --------------------------------- | ------------------------------- | ------------------------ |
| 单次句子 TTS (约 10 词)    | 语速 ~150 wpm → 约 **4 秒**       | 4s × 25 tokens = **100 tokens** | **$0.001**               |
| 用户每天 50 句 (深度练习)  | 50 句 × 4 秒 = 200 秒 (~3.3 分钟) | 50 × $0.001                     | **$0.05 / 天**           |
| **1000 DAU / 月 (无缓存)** | 1000 人 × 30 天                   | 1000 × 30 × $0.05               | **$1,500/月 (≈¥10,800)** |
| 1000 DAU / 月 (50% 缓存)   | 缓存命中率 50%                    | $1,500 × 50%                    | **$750/月 (≈¥5,400)**    |

##### 单词发音场景 (短词 TTS)

| 场景                     | 计算 (预估)          | 成本                  |
| ------------------------ | -------------------- | --------------------- |
| 每次单词 TTS (估 1秒)    | 25 tokens × $0.00001 | **$0.00025**          |
| 用户每天 100 词          | 100 × $0.00025       | **$0.025 / 天**       |
| 1000 DAU / 月 (无缓存)   | 1000 × 30 × $0.025   | **$750/月 (≈¥5,400)** |
| 1000 DAU / 月 (90% 缓存) | $750 × 10%           | **$75/月 (≈¥540)**    |

> 💡 **当前优势**:
>
> - ✅ Preview 模型有 **Free Tier** 额度
> - ✅ 拥有 **$25,000 GCP 赠金**，可覆盖相当长时间的运营成本
> - ✅ 得益于 **25 tokens/sec** 的低消耗率，成本远低于传统字符计费模式

---

### 5. Azure Speech - 发音评估

> 使用 Azure Speech Service 进行发音评估 (Pronunciation Assessment)

#### 定价模式

| 服务类型          | 计费方式         | 价格          |
| ----------------- | ---------------- | ------------- |
| 语音转文本 (实时) | 按秒计费         | **$1 / 小时** |
| 发音评估附加功能  | 包含在上述费用中 | 无额外费用    |

> 💡 **计费说明**: 发音评估功能的音素级评分、韵律分析等是 STT 价格的附加功能，无额外计费。

#### 成本估算

| 场景                       | 假设参数                          | 计算过程                      | 成本                     |
| -------------------------- | --------------------------------- | ----------------------------- | ------------------------ |
| 单次句子评估 (约 10 词)    | 语速 ~150 wpm → 约 **4 秒**       | 4s × ($1/3600s) = **$0.0011** | **$0.001**               |
| 用户每天 50 句 (深度练习)  | 50 句 × 4 秒 = 200 秒 (~3.3 分钟) | 3.3min × $0.0167/min          | **$0.055 / 天**          |
| **1000 DAU / 月 (无缓存)** | 1000 人 × 30 天                   | 1000 × 30 × $0.055            | **$1,650/月 (≈¥11,880)** |

> 📊 **对比分析**: Azure 发音评估的成本与 GCP Gemini TTS 相近（均在 $1,500-1,700/月 @ 1000 DAU），但提供了专业的发音诊断能力（音素级评分、韵律分析、流利度检测等）。

---

### 成本优化策略

| 策略                  | 影响服务     | 预估节省     |
| --------------------- | ------------ | ------------ |
| **TTS 音频缓存**      | GCP TTS      | 50-90%       |
| **本地 TTS Fallback** | GCP TTS      | 20-40%       |
| **发音评估结果缓存**  | Azure Speech | 30-50%       |
| **批量请求合并**      | All          | 10-20%       |
| **GCP $25K 赠金**     | GCP TTS      | 覆盖初期成本 |

---

## 🎯 成本控制建议

### 短期 (0-1000 DAU)

1. ✅ 充分利用各服务的 **Free Tier**
2. ✅ 使用 GCP **$25,000 赠金** 覆盖 TTS 成本
3. ✅ 实现高效的 **客户端缓存策略**，减少重复 API 调用

### 中期 (1000-10000 DAU)

1. ⚙️ 优化缓存命中率至 **80%+**
2. ⚙️ 评估引入 **CDN 缓存层** (Cloudflare R2)
3. ⚙️ 考虑 **Reserved Capacity** 获取更优价格

### 长期 (10000+ DAU)

1. 📈 与云服务商谈判 **企业折扣**
2. 📈 评估 **自建语音服务** 的可行性
3. 📈 实施 **分层定价策略** (免费/付费用户)

---

## 📚 相关文档

- [GCP TTS 实现指南](../backend/docs/gcp_tts.md)
- [单词发音播放方案](../backend/docs/word_pronunciation.md)
- [Azure Speech 发音评估设计](../backend/docs/azure_speech.md)
- [缓存策略文档](../frontend/doc/cache_strategy.md)

---

## 📝 更新日志

| 日期       | 更新内容                     |
| ---------- | ---------------------------- |
| 2026-01-19 | 初始版本：整合各服务成本分析 |
