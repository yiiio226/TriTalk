**ä¸­æ–‡** | [English](word_pronunciation_en.md)

# å•è¯å‘éŸ³æ’­æ”¾æ–¹æ¡ˆ

> ğŸ“‹ **åŠŸèƒ½è¯´æ˜**: åœ¨å‘éŸ³åé¦ˆé¡µé¢ï¼Œç”¨æˆ·ç‚¹å‡»ä»»æ„å•è¯æ—¶ï¼Œæ’­æ”¾è¯¥å•è¯çš„æ­£ç¡®å‘éŸ³ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

- âœ… ä½å»¶è¿Ÿï¼šç”¨æˆ·ç‚¹å‡»åå¿«é€Ÿå“åº”
- âœ… å¤šè¯­è¨€ï¼šæ”¯æŒè‹±è¯­ã€ä¸­æ–‡ã€æ—¥è¯­ã€éŸ©è¯­ç­‰å¤šç§è¯­è¨€
- âœ… é«˜è´¨é‡ï¼šå‘éŸ³å‡†ç¡®ï¼Œä¸è¯„ä¼°æ ‡å‡†ä¸€è‡´
- âœ… æˆæœ¬å¯æ§ï¼šé€šè¿‡ç¼“å­˜å‡å°‘ API è°ƒç”¨

---

## ğŸ“ æ··åˆæ–¹æ¡ˆæ¶æ„

```
ç”¨æˆ·ç‚¹å‡»å•è¯
    â†“
[1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜] â”€â”€â”€(æœ‰)â”€â”€â†’ ç›´æ¥æ’­æ”¾ âœ…
    â†“ (æ— )
[2. æ£€æŸ¥è¯­è¨€æ˜¯å¦æœ¬åœ° TTS æ”¯æŒ]
    â†“
  â”Œâ”€(æ”¯æŒ)â”€â”€â”€â”€â†’ [3a] æœ¬åœ° TTS æ’­æ”¾ âœ…ï¼ˆé›¶æˆæœ¬ï¼‰
  â”‚
  â””â”€(ä¸æ”¯æŒ)â”€â”€â†’ [3b] è¯·æ±‚äº‘ç«¯ TTS â†’ æ’­æ”¾ â†’ ç¼“å­˜
```

---

## ğŸ”€ äº‘ç«¯ TTS æœåŠ¡é€‰å‹

> âœ… **æœ€ç»ˆå†³ç­–**ï¼šé€‰æ‹© **Gemini 2.5 Flash Preview TTS** (é€šè¿‡ Vertex AI)
>
> ç†ç”±ï¼šå·²æœ‰ $25,000 GCP é¢åº¦ï¼Œè´¨é‡ä¼˜ç§€ï¼Œä½å»¶è¿Ÿï¼Œæ”¯æŒæµå¼è¾“å‡ºã€‚

### âœ… æ–¹æ¡ˆ: Gemini 2.5 Flash Preview TTSï¼ˆå·²é€‰æ‹©ï¼‰

| ç»´åº¦         | è¯´æ˜                                                          |
| ------------ | ------------------------------------------------------------- |
| **çŠ¶æ€**     | âœ… å·²é›†æˆï¼Œ`/tts/gcp/generate` (æµå¼) å’Œ `/tts/word` (éæµå¼) |
| **æ¨¡å‹**     | `gemini-2.5-flash-preview-tts`                                |
| **å¤šè¯­è¨€**   | âœ… æ”¯æŒå¤šè¯­è¨€ï¼Œå†…ç½®è¯­éŸ³å¯è‡ªåŠ¨é€‚é…                             |
| **å»¶è¿Ÿ**     | ğŸš€ æµå¼è¾“å‡ºï¼Œé¦–å­—èŠ‚å»¶è¿Ÿä½                                     |
| **è¾“å‡ºæ ¼å¼** | WAV (PCM 24kHz 16-bit mono)                                   |
| **ä¼˜åŠ¿**     | $25,000 GCP é¢åº¦å¯ç”¨ï¼Œè´¨é‡é«˜ï¼Œä½å»¶è¿Ÿ                          |
| **éŸ³è‰²**     | Kore(é»˜è®¤), Aoede, Charon, Fenrir, Puck, Orbit                |

#### ä»·æ ¼ (Vertex AI)

| é¡¹ç›®   | Free Tier      | Paid Tier (per 1M tokens) |
| ------ | -------------- | ------------------------- |
| Input  | Free of charge | $0.50 (text)              |
| Output | Free of charge | $10.00 (audio)            |

> ğŸ’¡ **æ³¨æ„**ï¼šPreview æ¨¡å‹æœ‰ Free Tier é¢åº¦ï¼Œä¸”æˆ‘ä»¬æœ‰ $25,000 GCP ä¿¡ç”¨é¢åº¦ã€‚

<details>
<summary>æ–¹æ¡ˆ B: Azure Speech TTSï¼ˆæœªä½¿ç”¨ï¼‰</summary>

| ç»´åº¦       | è¯´æ˜                        |
| ---------- | --------------------------- |
| **çŠ¶æ€**   | æœªé›†æˆ                      |
| **å¤šè¯­è¨€** | âœ… 140+ è¯­è¨€ï¼Œ400+ ç¥ç»è¯­éŸ³ |
| **å»¶è¿Ÿ**   | ~100-200ms                  |
| **åŠ£åŠ¿**   | éœ€é¢å¤–å¼€å‘ï¼Œæ— ç°æœ‰é¢åº¦      |

</details>

---

## ğŸ’° æˆæœ¬ä¼°ç®—

### åŸºç¡€å‡è®¾

- å•è¯å¹³å‡é•¿åº¦ï¼š7 å­—ç¬¦
- ç”¨æˆ·æ¯å¤©ç»ƒä¹ ï¼š100 ä¸ªå•è¯
- æœˆæ´»è·ƒç”¨æˆ·ï¼š1000 DAU

### âœ… Gemini 2.5 Flash Preview TTS æˆæœ¬ï¼ˆå½“å‰ä½¿ç”¨ï¼‰

| é¡¹ç›®   | Free Tier      | Paid Tier          |
| ------ | -------------- | ------------------ |
| Input  | Free of charge | $0.50 / 1M tokens  |
| Output | Free of charge | $10.00 / 1M tokens |

#### Free Tierï¼ˆå½“å‰ä½¿ç”¨ï¼‰

| åœºæ™¯                   | è¯´æ˜                  | æˆæœ¬      |
| ---------------------- | --------------------- | --------- |
| Preview æ¨¡å‹           | å…è´¹ä½¿ç”¨              | **$0**    |
| 1000 DAU / æœˆ          | Free Tier å†…          | **$0/æœˆ** |
| å¤‡ç”¨: $25,000 GCP é¢åº¦ | è¶…å‡º Free Tier æ—¶ä½¿ç”¨ | -         |

#### Paid Tierï¼ˆè¶…å‡º Free Tier åé¢„ä¼°ï¼‰

> ğŸ’¡ **Token ä¼°ç®—**ï¼š
>
> - è¾“å…¥ï¼šçº¦ 1 token â‰ˆ 4 å­—ç¬¦ï¼Œ7 å­—ç¬¦å•è¯ â‰ˆ 2 tokens
> - è¾“å‡ºï¼šéŸ³é¢‘ token æŒ‰ç”Ÿæˆçš„éŸ³é¢‘é•¿åº¦è®¡ç®—ï¼Œå•è¯çº¦äº§ç”Ÿ ~50-100 audio tokens

| åœºæ™¯                     | è®¡ç®—                     | æˆæœ¬                     |
| ------------------------ | ------------------------ | ------------------------ |
| Output å•ä»·              | $10.00 / 1M audio tokens | -                        |
| æ¯æ¬¡å•è¯ TTS (ä¼°)        | ~100 tokens Ã— $0.00001   | ~$0.001                  |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.001             | $0.10                    |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.10        | **$3,000/æœˆ (â‰ˆÂ¥21,600)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $3,000 Ã— 10%             | **$300/æœˆ (â‰ˆÂ¥2,160)**    |

> âš ï¸ **ä¸ºä½• Gemini æ€»ä»·æ›´é«˜ï¼Ÿ**
>
> è™½ç„¶ Gemini å•ä»· ($10) ä½äº Azure ($15)ï¼Œä½†è¿™æºäºè®¡è´¹å•ä½ä¸åŒï¼š
>
> - **Gemini**: æŒ‰ **Audio Output Tokens** è®¡è´¹ã€‚ç”Ÿæˆçš„éŸ³é¢‘ä¿¡æ¯å¯†åº¦æé«˜ï¼Œ**1 ä¸ªå•è¯ â‰ˆ 100 Tokens**ã€‚
> - **Azure**: æŒ‰ **Input Characters** è®¡è´¹ã€‚**1 ä¸ªå•è¯ â‰ˆ 7 å­—ç¬¦**ã€‚
>
> **ç»“è®º**ï¼šGemini ç”ŸæˆåŒä¸ªå•è¯çš„æ¶ˆè€—é‡ (Unit) æ˜¯ Azure çš„ ~14 å€ï¼Œå¯¼è‡´æœ€ç»ˆæˆæœ¬æ›´é«˜ã€‚
>
> âœ… **æˆ‘ä»¬çš„æƒ…å†µ**ï¼šç”±äºæˆ‘ä»¬æ‹¥æœ‰ **$25,000 GCP èµ é‡‘**ï¼Œè¿™ç¬”é¢åº¦å®Œå…¨è¦†ç›–äº†è¿™éƒ¨åˆ†å¼€é”€ï¼Œå®é™…æ”¯å‡ºä»ä¸º **$0**ã€‚ç›®å‰ä½¿ç”¨ Free Tierã€‚

### å…¶ä»–æœåŠ¡æˆæœ¬å¯¹æ¯”

<details>
<summary>Azure TTS æˆæœ¬</summary>

| åœºæ™¯                     | è®¡ç®—                | æˆæœ¬                  |
| ------------------------ | ------------------- | --------------------- |
| å•ä»·                     | $15 / ç™¾ä¸‡å­—ç¬¦      | -                     |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.000015       | $0.000105             |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.000105     | $0.0105               |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.0105 | **$315/æœˆ (â‰ˆÂ¥2,268)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $315 Ã— 10%          | **$31.5/æœˆ (â‰ˆÂ¥227)**  |

### OpenAI TTS æˆæœ¬

#### TTS-1 (æ ‡å‡†ç‰ˆ)

| åœºæ™¯                     | è®¡ç®—                | æˆæœ¬                  |
| ------------------------ | ------------------- | --------------------- |
| å•ä»·                     | $15 / ç™¾ä¸‡å­—ç¬¦      | -                     |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.000015       | $0.000105             |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.000105     | $0.0105               |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.0105 | **$315/æœˆ (â‰ˆÂ¥2,268)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $315 Ã— 10%          | **$31.5/æœˆ (â‰ˆÂ¥227)**  |

#### TTS-1-HD (é«˜æ¸…ç‰ˆ)

| åœºæ™¯                     | è®¡ç®—               | æˆæœ¬                  |
| ------------------------ | ------------------ | --------------------- |
| å•ä»·                     | $30 / ç™¾ä¸‡å­—ç¬¦     | -                     |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.00003       | $0.00021              |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.00021     | $0.021                |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.021 | **$630/æœˆ (â‰ˆÂ¥4,536)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $630 Ã— 10%         | **$63/æœˆ (â‰ˆÂ¥454)**    |

### ElevenLabs æˆæœ¬

> âš ï¸ ElevenLabs é‡‡ç”¨è®¢é˜…åˆ¶ï¼ŒæŒ‰é‡æŠ˜ç®—çº¦ $100-300/ç™¾ä¸‡å­—ç¬¦ï¼Œä»¥ä¸‹æŒ‰ $150/ç™¾ä¸‡å­—ç¬¦ ä¼°ç®—ã€‚

| åœºæ™¯                     | è®¡ç®—               | æˆæœ¬                     |
| ------------------------ | ------------------ | ------------------------ |
| å•ä»· (ä¼°ç®—)              | ~$150 / ç™¾ä¸‡å­—ç¬¦   | -                        |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.00015       | $0.00105                 |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.00105     | $0.105                   |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.105 | **$3,150/æœˆ (â‰ˆÂ¥22,680)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $3,150 Ã— 10%       | **$315/æœˆ (â‰ˆÂ¥2,268)**    |

### Google Cloud TTS æˆæœ¬

#### Standard (æ ‡å‡†ç‰ˆ)

| åœºæ™¯                     | è®¡ç®—                | æˆæœ¬               |
| ------------------------ | ------------------- | ------------------ |
| å•ä»·                     | $4 / ç™¾ä¸‡å­—ç¬¦       | -                  |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.000004       | $0.000028          |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.000028     | $0.0028            |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.0028 | **$84/æœˆ (â‰ˆÂ¥605)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $84 Ã— 10%           | **$8.4/æœˆ (â‰ˆÂ¥60)** |

> ğŸ’¡ å…è´¹é¢åº¦ï¼šWaveNet/Neural2 æ¯æœˆå‰ 100 ä¸‡å­—ç¬¦å…è´¹ï¼Œå¯è¦†ç›–çº¦ 143,000 æ¬¡å•è¯æ’­æ”¾ã€‚

#### WaveNet / Neural2 (é«˜è´¨é‡ç‰ˆ)

| åœºæ™¯                     | è®¡ç®—                | æˆæœ¬                  |
| ------------------------ | ------------------- | --------------------- |
| å•ä»·                     | $16 / ç™¾ä¸‡å­—ç¬¦      | -                     |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.000016       | $0.000112             |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.000112     | $0.0112               |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.0112 | **$336/æœˆ (â‰ˆÂ¥2,419)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $336 Ã— 10%          | **$33.6/æœˆ (â‰ˆÂ¥242)**  |

### Amazon Polly æˆæœ¬

#### Standard (æ ‡å‡†ç‰ˆ)

| åœºæ™¯                     | è®¡ç®—                | æˆæœ¬               |
| ------------------------ | ------------------- | ------------------ |
| å•ä»·                     | $4 / ç™¾ä¸‡å­—ç¬¦       | -                  |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.000004       | $0.000028          |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.000028     | $0.0028            |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.0028 | **$84/æœˆ (â‰ˆÂ¥605)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $84 Ã— 10%           | **$8.4/æœˆ (â‰ˆÂ¥60)** |

#### Neural (ç¥ç»ç½‘ç»œç‰ˆ)

| åœºæ™¯                     | è®¡ç®—                | æˆæœ¬                  |
| ------------------------ | ------------------- | --------------------- |
| å•ä»·                     | $16 / ç™¾ä¸‡å­—ç¬¦      | -                     |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.000016       | $0.000112             |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.000112     | $0.0112               |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.0112 | **$336/æœˆ (â‰ˆÂ¥2,419)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $336 Ã— 10%          | **$33.6/æœˆ (â‰ˆÂ¥242)**  |

> ğŸ’¡ å…è´¹é¢åº¦ï¼šNeural å¼•æ“é¦–å¹´æ¯æœˆ 100 ä¸‡å­—ç¬¦å…è´¹ã€‚

#### Generative (ç”Ÿæˆå¼)

| åœºæ™¯                     | è®¡ç®—               | æˆæœ¬                  |
| ------------------------ | ------------------ | --------------------- |
| å•ä»·                     | $30 / ç™¾ä¸‡å­—ç¬¦     | -                     |
| æ¯æ¬¡å•è¯ TTS             | 7 Ã— $0.00003       | $0.00021              |
| ç”¨æˆ·æ¯å¤© 100 è¯          | 100 Ã— $0.00021     | $0.021                |
| 1000 DAU / æœˆ (æ— ç¼“å­˜)   | 1000 Ã— 30 Ã— $0.021 | **$630/æœˆ (â‰ˆÂ¥4,536)** |
| 1000 DAU / æœˆ (90% ç¼“å­˜) | $630 Ã— 10%         | **$63/æœˆ (â‰ˆÂ¥454)**    |

| æœåŠ¡                    | å•ä»·           | æ— ç¼“å­˜ (Â¥/æœˆ) | 90% ç¼“å­˜ (Â¥/æœˆ) | è´¨é‡è¯„ä»·      |
| ----------------------- | -------------- | ------------- | --------------- | ------------- |
| **âœ… Gemini 2.5 Flash** | **Free Tier**  | **Â¥0**        | **Â¥0**          | ğŸŸ¢ ä¼˜ç§€       |
| Google/AWS Standard     | $4/ç™¾ä¸‡å­—ç¬¦    | Â¥605          | Â¥60             | ğŸŸ¡ æœºæ¢°       |
| Azure Neural            | $15/ç™¾ä¸‡å­—ç¬¦   | Â¥2,268        | Â¥227            | ğŸŸ¢ ä¼˜ç§€       |
| OpenAI TTS-1            | $15/ç™¾ä¸‡å­—ç¬¦   | Â¥2,268        | Â¥227            | ğŸŸ¢ ä¼˜ç§€       |
| Google WaveNet/Neural2  | $16/ç™¾ä¸‡å­—ç¬¦   | Â¥2,419        | Â¥242            | ğŸŸ¢ ä¼˜ç§€       |
| AWS Polly Neural        | $16/ç™¾ä¸‡å­—ç¬¦   | Â¥2,419        | Â¥242            | ğŸŸ¢ ä¼˜ç§€       |
| OpenAI TTS-1-HD         | $30/ç™¾ä¸‡å­—ç¬¦   | Â¥4,536        | Â¥454            | ğŸŸ¢ é«˜æ¸…       |
| AWS Polly Generative    | $30/ç™¾ä¸‡å­—ç¬¦   | Â¥4,536        | Â¥454            | ğŸŸ¢ é«˜æ¸…       |
| ElevenLabs (~$150)      | ~$150/ç™¾ä¸‡å­—ç¬¦ | Â¥22,680       | Â¥2,268          | ğŸŸ¢ å£°éŸ³å…‹éš†å¼º |

> ğŸ’¡ **ç¼“å­˜ç­–ç•¥è‡³å…³é‡è¦**ï¼šæ— è®ºé€‰æ‹©å“ªä¸ªæœåŠ¡ï¼Œ90% ç¼“å­˜å‘½ä¸­ç‡å¯é™ä½ 90% æˆæœ¬ã€‚
>
> âœ… **æœ€ç»ˆé€‰æ‹©**ï¼š
>
> - **Gemini 2.5 Flash Preview TTS**ï¼šFree Tier + $25,000 GCP é¢åº¦ï¼Œæˆæœ¬ä¸º $0ï¼Œè´¨é‡ä¼˜ç§€ï¼Œå·²é›†æˆã€‚

---

## ğŸ“ å®ç°æ­¥éª¤æ¸…å•

### Phase 1: åç«¯ API

- [x] **1.1** æ–°å¢ `/tts/word` ç«¯ç‚¹ï¼ˆä½¿ç”¨ GCP Vertex AI Gemini TTSï¼‰
- [x] **1.2** æ”¯æŒå¤šè¯­è¨€å‚æ•°ï¼ˆlanguage, voice_nameï¼‰
- [x] **1.3** è¿”å› WAV éŸ³é¢‘æ•°æ®ï¼ˆbase64ï¼‰
- [ ] **1.4** æ·»åŠ  API æµ‹è¯•ç”¨ä¾‹

### Phase 2: å‰ç«¯åŸºç¡€

- [x] **2.1** æ·»åŠ  `flutter_tts` ä¾èµ–
- [x] **2.2** åˆ›å»º `WordTtsService` æœåŠ¡ç±»
- [x] **2.3** å®ç°æœ¬åœ° TTS æ’­æ”¾åŠŸèƒ½
- [x] **2.4** å®ç°è¯­è¨€æ”¯æŒæ£€æµ‹ï¼ˆ`getLanguages()`ï¼‰

### Phase 3: ç¼“å­˜å±‚

- [x] **3.1** è®¾è®¡å•è¯éŸ³é¢‘ç¼“å­˜ç»“æ„
- [ ] **3.2** å®ç°å†…å­˜ç¼“å­˜ï¼ˆLRUï¼‰
- [x] **3.3** å®ç°ç£ç›˜ç¼“å­˜ï¼ˆæŒä¹…åŒ–ï¼‰
- [ ] **3.4** ç¼“å­˜è¿‡æœŸç­–ç•¥

### Phase 4: æ··åˆç­–ç•¥

- [x] **4.1** å®ç°ç¼“å­˜ä¼˜å…ˆæ£€æŸ¥
- [x] **4.2** å®ç°æœ¬åœ° TTS fallback
- [x] **4.3** å®ç°äº‘ç«¯ TTS è¯·æ±‚ + åå°ç¼“å­˜
- [x] **4.4** é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

### Phase 5: UI é›†æˆ

- [x] **5.1** åœ¨ `VoiceFeedbackSheet` ä¸­æ·»åŠ å•è¯ç‚¹å‡»äº‹ä»¶
- [ ] **5.2** æ·»åŠ æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºï¼ˆloading/playingï¼‰
- [ ] **5.3** æ·»åŠ æ’­æ”¾åŠ¨ç”»æ•ˆæœ
- [x] **5.4** å¤„ç†è¿ç»­å¿«é€Ÿç‚¹å‡»

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ–

- [ ] **6.1** å•å…ƒæµ‹è¯•
- [ ] **6.2** é›†æˆæµ‹è¯•
- [ ] **6.3** æ€§èƒ½æµ‹è¯•ï¼ˆå»¶è¿Ÿã€ç¼“å­˜å‘½ä¸­ç‡ï¼‰
- [ ] **6.4** å¤šè¯­è¨€æµ‹è¯•

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åç«¯ API è®¾è®¡

```
POST /tts/word
Content-Type: application/json

Request:
{
  "word": "pineapple",
  "language": "en-US",       // ç”¨äºè‡ªåŠ¨é€‰æ‹©è¯­éŸ³
  "voice_name": "Kore"       // å¯é€‰ï¼ŒGemini TTS è¯­éŸ³åç§°
}

Response:
{
  "audio_base64": "UklGRi...",  // WAV æ ¼å¼éŸ³é¢‘
  "format": "wav",               // PCM 24kHz 16-bit mono
  "mime_type": "audio/wav"
}
```

> âœ… **éŸ³é¢‘æ ¼å¼è¯´æ˜**ï¼š
>
> | æœåŠ¡                     | æ ¼å¼ | é‡‡æ ·ç‡ | å¤‡æ³¨                           |
> | ------------------------ | ---- | ------ | ------------------------------ |
> | **Gemini 2.5 Flash TTS** | WAV  | 24kHz  | PCM 16-bit monoï¼Œå·²åŒ…å« header |
>
> å‰ç«¯æ’­æ”¾å™¨éœ€æ”¯æŒ WAV æ ¼å¼éŸ³é¢‘ã€‚

### Gemini TTS è¯­éŸ³é€‰æ‹©

| è¯­éŸ³åç§° | ç‰¹ç‚¹                         | æ¨èåœºæ™¯   |
| -------- | ---------------------------- | ---------- |
| Kore     | Clear, natural female (é»˜è®¤) | è‹±è¯­       |
| Aoede    | Warm, expressive female      | è¡¨è¾¾æ€§å†…å®¹ |
| Charon   | Deep, authoritative male     | æ­£å¼åœºåˆ   |
| Fenrir   | Energetic, dynamic male      | æ—¥è¯­       |
| Puck     | Friendly, conversational     | éŸ©è¯­       |
| Orbit    | Neutral, professional        | ä¸­æ–‡å…¼å®¹   |

### å¤šè¯­è¨€é…ç½®

```dart
class LanguageConfig {
  final String geminiVoice;   // Gemini TTS voice name
  final String localTtsLocale;
  final String displayName;
}

const Map<String, LanguageConfig> languageConfigs = {
  'en-US': LanguageConfig(
    geminiVoice: 'Kore',
    localTtsLocale: 'en-US',
    displayName: 'English (US)',
  ),
  'en-GB': LanguageConfig(
    geminiVoice: 'Kore',
    localTtsLocale: 'en-GB',
    displayName: 'English (UK)',
  ),
  'zh-CN': LanguageConfig(
    geminiVoice: 'Orbit',  // Neutral, ä¸­æ–‡å…¼å®¹
    localTtsLocale: 'zh-CN',
    displayName: 'ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰',
  ),
  'ja-JP': LanguageConfig(
    geminiVoice: 'Fenrir',  // Dynamic, æ—¥è¯­é€‚é…
    localTtsLocale: 'ja-JP',
    displayName: 'æ—¥æœ¬èª',
  ),
  'ko-KR': LanguageConfig(
    geminiVoice: 'Puck',  // Friendly, éŸ©è¯­é€‚é…
    localTtsLocale: 'ko-KR',
    displayName: 'í•œêµ­ì–´',
  ),
  // æ‰©å±•æ›´å¤šè¯­è¨€...
};
```

### ç¼“å­˜ç»“æ„

```
ğŸ“ app_documents/
â””â”€â”€ ğŸ“ word_tts_cache/
    â””â”€â”€ ğŸ“ {language}/
        â”œâ”€â”€ {encoded_word}.{format}
        â””â”€â”€ ...
```

> ğŸ’¡ ç¼“å­˜æŒ‰è¯­è¨€åˆ†ç›®å½•ï¼Œä¸æŒ‰ç”¨æˆ·åˆ†ã€‚åŒä¸€å•è¯çš„å‘éŸ³å¯¹æ‰€æœ‰ç”¨æˆ·ä¸€è‡´ã€‚

#### æ–‡ä»¶å‘½åè§„åˆ™

ç”±äºä¸åŒè¯­è¨€å¯èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼ˆä¸­æ–‡ã€æ—¥è¯­ã€éŸ©è¯­ã€æ’‡å·ã€è¿å­—ç¬¦ç­‰ï¼‰ï¼Œæ–‡ä»¶åéœ€è¦ç¼–ç å¤„ç†ï¼š

| æ–¹æ¡ˆ              | ç¤ºä¾‹                                      | ä¼˜ç¼ºç‚¹                           |
| ----------------- | ----------------------------------------- | -------------------------------- |
| URL ç¼–ç           | `pineapple.wav`, `%E4%BD%A0%E5%A5%BD.wav` | âš ï¸ å¤§å°å†™é—®é¢˜ï¼Œé•¿åº¦å¯èƒ½è¶…é™      |
| **Hash (MD5)** âœ… | `a1b2c3d4e5f6.wav`                        | âœ… é•¿åº¦å›ºå®šï¼Œæ— ç‰¹æ®Šå­—ç¬¦          |
| Base64            | `cGluZWFwcGxl.wav`                        | âš ï¸ å¯èƒ½è¾ƒé•¿ï¼Œå« `/` `+` ç‰¹æ®Šå­—ç¬¦ |

> ğŸ“ **å»ºè®®**ï¼šä½¿ç”¨ Hashï¼ˆMD5ï¼‰æ–¹æ¡ˆï¼Œé…åˆå…ƒæ•°æ®æ–‡ä»¶æ”¯æŒè°ƒè¯•ã€‚

#### å‘½åå¤„ç†æµç¨‹

```
åŸå§‹å•è¯ â†’ ç»Ÿä¸€è½¬å°å†™ â†’ MD5 Hash â†’ æ–‡ä»¶å
```

ç¤ºä¾‹ï¼š
| åŸå§‹å•è¯ | è½¬å°å†™ | MD5 Hash | æ–‡ä»¶å |
|----------|--------|----------|--------|
| `Hello` | `hello` | `5d41402abc4b2a76...` | `5d41402abc4b2a76.wav` |
| `hello` | `hello` | `5d41402abc4b2a76...` | `5d41402abc4b2a76.wav` |
| `ä½ å¥½` | `ä½ å¥½` | `7eca689f0d3389d9...` | `7eca689f0d3389d9.wav` |

> ğŸ’¡ **å¤§å°å†™å¤„ç†**ï¼šç»Ÿä¸€è½¬å°å†™åå† hashï¼Œç¡®ä¿ `Hello` å’Œ `hello` å‘½ä¸­åŒä¸€ç¼“å­˜ã€‚

#### å…ƒæ•°æ®æ–‡ä»¶ï¼ˆè°ƒè¯•ç”¨ï¼‰

ä¸ºä¾¿äºè°ƒè¯•ï¼Œæ¯ä¸ªè¯­è¨€ç›®å½•ä¸‹ç»´æŠ¤ä¸€ä¸ª `_metadata.json` æ–‡ä»¶ï¼š

```json
{
  "5d41402abc4b2a76": {
    "word": "hello",
    "format": "wav",
    "createdAt": "2026-01-16T10:30:00Z",
    "source": "gemini"
  },
  "7eca689f0d3389d9": {
    "word": "ä½ å¥½",
    "format": "wav",
    "createdAt": "2026-01-16T10:31:00Z",
    "source": "gemini"
  }
}
```

ç¼“å­˜ç›®å½•ç»“æ„ï¼š

```
ğŸ“ word_tts_cache/
â””â”€â”€ ğŸ“ en-US/
    â”œâ”€â”€ _metadata.json
    â”œâ”€â”€ 5d41402abc4b2a76.wav
    â””â”€â”€ ...
â””â”€â”€ ğŸ“ zh-CN/
    â”œâ”€â”€ _metadata.json
    â”œâ”€â”€ 7eca689f0d3389d9.wav
    â””â”€â”€ ...
```

#### ç¼“å­˜æŸ¥è¯¢è§„åˆ™

**æŸ¥è¯¢æ—¶åº”å¿½ç•¥æ–‡ä»¶æ‰©å±•å**ï¼Œä»¥æ”¯æŒæ ¼å¼å˜æ›´ï¼š

```dart
import 'package:crypto/crypto.dart';
import 'dart:convert';

// ç”Ÿæˆç¼“å­˜ keyï¼ˆç»Ÿä¸€å°å†™ + MD5ï¼‰
String getCacheKey(String word) {
  final normalized = word.toLowerCase();
  final bytes = utf8.encode(normalized);
  final hash = md5.convert(bytes).toString();
  return hash.substring(0, 16);  // å–å‰ 16 ä½è¶³å¤Ÿ
}

// æŸ¥è¯¢ç¼“å­˜æ—¶ï¼ŒåªåŒ¹é…æ–‡ä»¶åå‰ç¼€
Future<String?> findCachedAudio(String word, String language) async {
  final cacheKey = getCacheKey(word);
  final cacheDir = Directory('$basePath/$language');

  if (!await cacheDir.exists()) return null;

  // æŸ¥æ‰¾ä»»æ„æ ¼å¼çš„ç¼“å­˜æ–‡ä»¶
  await for (final file in cacheDir.list()) {
    final fileName = path.basenameWithoutExtension(file.path);
    if (fileName == cacheKey) {
      return file.path;  // æ‰¾åˆ°ç¼“å­˜ï¼Œæ— è®ºæ ¼å¼
    }
  }
  return null;  // æœªå‘½ä¸­ç¼“å­˜
}
```

è¿™æ ·å³ä½¿ä» MP3 åˆ‡æ¢åˆ° WAVï¼Œç°æœ‰ç¼“å­˜ä»ç„¶æœ‰æ•ˆã€‚

### WordTtsService æ¥å£

```dart
abstract class WordTtsService {
  /// æ’­æ”¾å•è¯å‘éŸ³
  /// è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç­–ç•¥ï¼ˆç¼“å­˜ â†’ æœ¬åœ° TTS â†’ äº‘ç«¯ TTSï¼‰
  Future<void> speakWord(String word, String language);

  /// é¢„åŠ è½½å•è¯åˆ—è¡¨ï¼ˆåå°ä¸‹è½½ï¼‰
  Future<void> preloadWords(List<String> words, String language);

  /// æ£€æŸ¥è¯­è¨€æ˜¯å¦æ”¯æŒæœ¬åœ° TTS
  Future<bool> isLocalTtsAvailable(String language);

  /// æ¸…é™¤ç¼“å­˜
  Future<void> clearCache({String? language});
}
```

---

## ğŸ“š ç›¸å…³èµ„æº

### âœ… Gemini 2.5 Flash TTSï¼ˆå½“å‰ä½¿ç”¨ï¼‰

- [Vertex AI Gemini TTS å®šä»·](https://cloud.google.com/vertex-ai/generative-ai/pricing)
- [Gemini TTS æ–‡æ¡£](https://cloud.google.com/vertex-ai/generative-ai/docs/speech/text-to-speech)
- [åç«¯é›†æˆä»£ç ](../../backend/src/services/gcp-tts.ts)
- [TTS ç«¯ç‚¹](../../backend/src/server.ts) - `/tts/gcp/generate` (æµå¼) å’Œ `/tts/word` (éæµå¼)
- [GCP TTS å®ç°æŒ‡å—](../../backend/docs/gcp_tts.md)

### å…¶ä»–å‚è€ƒ

<details>
<summary>Azure Speech TTS</summary>

- [Azure Speech TTS æ–‡æ¡£](https://learn.microsoft.com/azure/ai-services/speech-service/text-to-speech)
- [Azure æ”¯æŒçš„è¯­éŸ³åˆ—è¡¨](https://learn.microsoft.com/azure/ai-services/speech-service/language-support?tabs=tts)
- [Azure å®šä»·](https://azure.microsoft.com/en-us/pricing/details/speech/)

</details>

### å‰ç«¯

- [flutter_tts åŒ…](https://pub.dev/packages/flutter_tts)
- [å‘éŸ³åé¦ˆç»„ä»¶](../lib/features/chat/presentation/widgets/voice_feedback_sheet.dart)
