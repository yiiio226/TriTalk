# RevenueCat è®¢é˜…å®ç°æ–¹æ¡ˆ

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° TriTalk åº”ç”¨çš„è®¢é˜…åˆ¶å®ç°æ–¹æ¡ˆï¼Œä½¿ç”¨ RevenueCat ä½œä¸ºç»Ÿä¸€çš„ IAPï¼ˆåº”ç”¨å†…è´­ä¹°ï¼‰ç®¡ç†å¹³å°ï¼Œä»…æ”¯æŒ Apple App Store å’Œ Google Play Store çš„åŸç”Ÿ IAPã€‚

### 1.1 è®¢é˜…äº§å“ç»“æ„

| ç­‰çº§ | åç§° | ä¸­æ–‡å | æœˆä»˜ä»·æ ¼ | å¹´ä»˜ä»·æ ¼ | å¹´ä»˜èŠ‚çœ |
| ---- | ---- | ------ | -------- | -------- | -------- |
| Free | Free | å…è´¹ç‰ˆ | $0/æœˆ    | -        | -        |
| Plus | Plus | è¿›é˜¶ç‰ˆ | $6.8/æœˆ  | $49/å¹´   | çœ $32.6 |
| Pro  | Pro  | ä¸“ä¸šç‰ˆ | $13.8/æœˆ | $99/å¹´   | çœ $66.6 |

### 1.2 æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Flutter App                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             RevenueCat SDK (purchases_flutter)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apple Store    â”‚ â”‚  Google Play    â”‚ â”‚  RevenueCat     â”‚
â”‚  Connect        â”‚ â”‚  Console        â”‚ â”‚  Dashboard      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  RevenueCat Server  â”‚
                   â”‚     (Webhooks)      â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  TriTalk Backend    â”‚
                   â”‚  (Cloudflare Worker)â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚     Supabase        â”‚
                   â”‚   (User Profiles)   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 è®¢é˜…çŠ¶æ€æµè½¬å›¾

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚                                     â”‚
                                    â–¼                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  INITIAL_PURCHASE  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  RENEWAL    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  FREE   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ACTIVE  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ ACTIVE  â”‚â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                              â”‚
     â”‚                              â”‚ CANCELLATION
     â”‚                              â–¼
     â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                         â”‚ CANCELLED â”‚ (ä»åœ¨æœ‰æ•ˆæœŸå†…ï¼Œåˆ°æœŸåä¸ç»­è®¢)
     â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                              â”‚
     â”‚                              â”‚ EXPIRATION
     â”‚                              â–¼
     â”‚  EXPIRATION            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ EXPIRED â”‚
     â–²                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚
     â”‚  REFUND (é€€æ¬¾)
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                        â”‚
                            ä»»ä½•ä»˜è´¹çŠ¶æ€ â”€â”€â”€â”€â”€â”€â”€REFUNDâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹æ®Šæµç¨‹ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
UNCANCELLATION: CANCELLED â”€â”€â–¶ ACTIVE (ç”¨æˆ·å–æ¶ˆååˆæ¢å¤è®¢é˜…)
PRODUCT_CHANGE: ACTIVE(Plus) â”€â”€â–¶ ACTIVE(Pro) (å‡çº§/é™çº§ï¼Œä¿æŒ ACTIVE)
TRANSFER: ç”¨æˆ· A çš„è®¢é˜… â”€â”€â–¶ ç”¨æˆ· B (è®¢é˜…è½¬ç§»åˆ°æ–°ç”¨æˆ·)
```

**çŠ¶æ€è¯´æ˜ï¼š**

| çŠ¶æ€           | å«ä¹‰                       | ç”¨æˆ·æƒç›Š |
| -------------- | -------------------------- | -------- |
| `free`         | å…è´¹ç”¨æˆ·æˆ–è®¢é˜…è¿‡æœŸ         | åŸºç¡€åŠŸèƒ½ |
| `active`       | è®¢é˜…æœ‰æ•ˆ                   | å®Œæ•´åŠŸèƒ½ |
| `cancelled`    | å·²å–æ¶ˆä½†åœ¨å½“å‰å‘¨æœŸå†…ä»æœ‰æ•ˆ | å®Œæ•´åŠŸèƒ½ |
| `grace_period` | (æš‚æœªå¯ç”¨)                 | -        |
| `expired`      | è®¢é˜…å·²è¿‡æœŸ                 | åŸºç¡€åŠŸèƒ½ |

---

## 2. RevenueCat é…ç½®

### 2.1 RevenueCat é¡¹ç›®è®¾ç½®

#### 2.1.1 åˆ›å»º RevenueCat é¡¹ç›®

1. ç™»å½• [RevenueCat Dashboard](https://app.revenuecat.com)
2. åˆ›å»ºæ–°é¡¹ç›® "TriTalk"
3. æ·»åŠ  Apps:
   - Apple App Store (iOS)
   - Google Play Store (Android)

#### 2.1.2 é…ç½® Store è¿æ¥

**Apple App Store:**

- App Store Connect API Key (æ¨è)
- æˆ–è€…ä½¿ç”¨ Shared Secret

**Google Play Store:**

- æœåŠ¡è´¦å· JSON å¯†é’¥
- å¯ç”¨ Google Play Developer API

### 2.2 Products é…ç½®

åœ¨ RevenueCat ä¸­åˆ›å»ºä»¥ä¸‹äº§å“ï¼š

| Product ID           | ç±»å‹         | æè¿°           |
| -------------------- | ------------ | -------------- |
| `tritalkplusmonthly` | Subscription | Plus æœˆä»˜ $6.8 |
| `tritalkplusyearly`  | Subscription | Plus å¹´ä»˜ $49  |
| `tritalkpromonthly`  | Subscription | Pro æœˆä»˜ $13.8 |
| `tritalkproyearly`   | Subscription | Pro å¹´ä»˜ $99   |

> **âš ï¸ Product ID å‘½åè§„èŒƒ**
>
> Product ID é‡‡ç”¨**çº¯å°å†™å­—æ¯**æ ¼å¼ï¼Œè¿™æ˜¯ä¸ºäº†åŒæ—¶æ»¡è¶³ Apple å’Œ Google Play çš„å‘½åè§„åˆ™ï¼š
>
> | å¹³å°              | å…è®¸çš„å­—ç¬¦                          |
> | ----------------- | ----------------------------------- |
> | Apple App Store   | å­—æ¯æ•°å­—ã€å¥ç‚¹(.)ã€ä¸‹åˆ’çº¿(\_)       |
> | Google Play Store | å°å†™å­—æ¯(a-z)ã€æ•°å­—(0-9)ã€è¿å­—ç¬¦(-) |
>
> **äº¤é›†åªæœ‰**ï¼šå°å†™å­—æ¯ + æ•°å­—ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ `tritalkplusmonthly` è€Œé `tritalk_plus_monthly`ã€‚

#### 2.2.1 Google Play Base Plan æ ¼å¼è¯´æ˜

Google Play çš„è®¢é˜…æ¨¡å‹ä¸ Apple æœ‰æœ¬è´¨åŒºåˆ«ï¼š

| ç‰¹æ€§           | Apple App Store            | Google Play Store                         |
| -------------- | -------------------------- | ----------------------------------------- |
| äº§å“ç»“æ„       | æ¯ä¸ª Product ID æ˜¯ç‹¬ç«‹è®¢é˜… | ä¸€ä¸ª Subscription ä¸‹å¯æœ‰å¤šä¸ª Base Plan    |
| æ ‡è¯†ç¬¦æ ¼å¼     | `tritalkplusmonthly`       | `tritalkplusmonthly:monthly-autorenewing` |
| ç”¨æˆ·è´­ä¹°çš„å¯¹è±¡ | Product                    | Base Planï¼ˆä¸æ˜¯ Subscription æœ¬èº«ï¼‰       |
| ä»·æ ¼/å‘¨æœŸé…ç½®  | ç›´æ¥åœ¨ Product ä¸Š          | åœ¨ Base Plan ä¸Šé…ç½®                       |

**Google Play Console é…ç½®ç¤ºä¾‹ï¼š**

```
Subscription: tritalkplusmonthly
â”œâ”€â”€ Base Plan: monthly-autorenewing (æœˆä»˜, è‡ªåŠ¨ç»­è®¢)
â”‚   â””â”€â”€ Price: $6.8/æœˆ
â”‚
Subscription: tritalkplusyearly
â”œâ”€â”€ Base Plan: annual-autorenewing (å¹´ä»˜, è‡ªåŠ¨ç»­è®¢)
â”‚   â””â”€â”€ Price: $49/å¹´
```

**RevenueCat å¦‚ä½•å¤„ç†å·®å¼‚ï¼š**

RevenueCat å°† Google Play çš„ Base Plan æ˜ å°„ä¸ºå…¶ Productï¼Œå› æ­¤ï¼š

- åœ¨ RevenueCat Dashboard ä¸º **Android åº”ç”¨**é…ç½®äº§å“æ—¶ï¼Œä½¿ç”¨å®Œæ•´çš„ `subscriptionId:basePlanId` æ ¼å¼
- RevenueCat SDK è¿”å›çš„ `storeProduct.identifier` åœ¨ä¸åŒå¹³å°æ ¼å¼ä¸åŒ

| RevenueCat Product é…ç½® | iOS åº”ç”¨             | Android åº”ç”¨                              |
| ----------------------- | -------------------- | ----------------------------------------- |
| Plus æœˆä»˜               | `tritalkplusmonthly` | `tritalkplusmonthly:monthly-autorenewing` |
| Plus å¹´ä»˜               | `tritalkplusyearly`  | `tritalkplusyearly:annual-autorenewing`   |
| Pro æœˆä»˜                | `tritalkpromonthly`  | `tritalkpromonthly:monthly-autorenewing`  |
| Pro å¹´ä»˜                | `tritalkproyearly`   | `tritalkproyearly:annual-autorenewing`    |

> **ğŸ’¡ å¼€å‘æç¤º**
>
> ç”±äº RevenueCat æŠ½è±¡äº†è¿™ä¸ªå·®å¼‚ï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­éœ€è¦åšçš„å¤„ç†æ˜¯ï¼š
>
> 1. **åç«¯ Webhook**ï¼šä» `product_id` æå–åŸºç¡€ IDï¼ˆé€šè¿‡ `split(':')[0]`ï¼‰
> 2. **å‰ç«¯åŒ¹é…äº§å“**ï¼šä½¿ç”¨ `startsWith()` åŒ¹é…è€Œéç²¾ç¡®åŒ¹é…

### 2.3 Entitlements é…ç½®

åˆ›å»ºä»¥ä¸‹ Entitlementsï¼š

| Entitlement ID | å…³è”äº§å“                                  | æè¿°          |
| -------------- | ----------------------------------------- | ------------- |
| `plus`         | `tritalkplusmonthly`, `tritalkplusyearly` | Plus ä¼šå‘˜æƒç›Š |
| `pro`          | `tritalkpromonthly`, `tritalkproyearly`   | Pro ä¼šå‘˜æƒç›Š  |

> **æ³¨æ„**: Pro ç”¨æˆ·åŒæ—¶æ‹¥æœ‰ `pro` å’Œ `plus` entitlementsï¼ˆæˆ–è€…ä»…ä½¿ç”¨ `pro` å¹¶åœ¨åº”ç”¨å±‚é¢å¤„ç†æƒé™åŒ…å«å…³ç³»ï¼‰

### 2.4 Offerings é…ç½®

åˆ›å»ºä»¥ä¸‹ Offeringsï¼š

| Offering ID | æè¿°             | åŒ…å« Packages |
| ----------- | ---------------- | ------------- |
| `default`   | é»˜è®¤å±•ç¤ºæ–¹æ¡ˆ     | æ‰€æœ‰äº§å“      |
| `promotion` | ä¿ƒé”€æ–¹æ¡ˆï¼ˆå¯é€‰ï¼‰ | ç‰¹ä»·äº§å“      |

**Packages é…ç½®ç¤ºä¾‹ï¼ˆdefault offeringï¼‰:**

| Package ID     | äº§å“                 | æè¿°      |
| -------------- | -------------------- | --------- |
| `plus_monthly` | `tritalkplusmonthly` | Plus æœˆä»˜ |
| `plus_annual`  | `tritalkplusyearly`  | Plus å¹´ä»˜ |
| `pro_monthly`  | `tritalkpromonthly`  | Pro æœˆä»˜  |
| `pro_annual`   | `tritalkproyearly`   | Pro å¹´ä»˜  |

> **ğŸ’¡ Package ID å‘½åè¯´æ˜**
>
> - RevenueCat æœ‰é¢„å®šä¹‰çš„ Package IDï¼ˆå¦‚ `$rc_monthly`, `$rc_annual`ï¼‰ï¼Œä½†è¿™åªæ˜¯å¿«æ·æ–¹å¼
> - **æ¨èä½¿ç”¨è‡ªå®šä¹‰ Package ID**ï¼ˆå¦‚ `plus_monthly`ï¼‰ï¼Œæ›´æ¸…æ™°ä¸”é¿å…ä¸å…¶ä»–äº§å“å†²çª
> - åœ¨ä»£ç ä¸­é€šè¿‡ `identifier` æˆ– `packageType` åŒ¹é…äº§å“

### 2.5 å‡çº§/é™çº§ç­–ç•¥ï¼ˆProrateï¼‰

è®¢é˜…å‡çº§/é™çº§æ”¯æŒç«‹å³ç”Ÿæ•ˆå¹¶æŒ‰æ¯”ä¾‹è®¡ç®—ï¼š

**Apple App Store:**

1. åœ¨ App Store Connect â†’ Subscriptions â†’ è®¢é˜…ç»„
2. è®¾ç½® "Subscription Upgrade/Downgrade" ç­–ç•¥ä¸º "Immediately"
3. è‹¹æœè‡ªåŠ¨å¤„ç† prorate é€€æ¬¾ï¼ˆå‡çº§æ—¶é€€è¿˜å‰©ä½™é‡‘é¢ï¼‰

**Google Play Store:**

1. åœ¨ Google Play Console â†’ Monetization â†’ Subscriptions
2. é…ç½® Base Plan çš„æ›¿æ¢æ¨¡å¼ï¼š
   - å‡çº§ï¼šé€‰æ‹© `CHARGE_PRORATED_PRICE`ï¼ˆç«‹å³æ”¶å–å·®ä»·ï¼‰
   - é™çº§ï¼šé€‰æ‹© `DEFERRED`ï¼ˆå½“å‰å‘¨æœŸç»“æŸåç”Ÿæ•ˆï¼‰æˆ– `CHARGE_PRORATED_PRICE`

**RevenueCat å¤„ç†ï¼š**

å½“ç”¨æˆ·å‡çº§/é™çº§æ—¶ï¼ŒRevenueCat ä¼šå‘é€ `PRODUCT_CHANGE` webhookï¼ŒåŒ…å«ï¼š

- `product_id`: æ–°çš„äº§å“ ID
- `expiration_at_ms`: æ–°çš„åˆ°æœŸæ—¶é—´ï¼ˆå¯èƒ½å›  prorate è°ƒæ•´ï¼‰

---

## 3. è¯¦ç»†å®æ–½æ–‡æ¡£

æœ‰å…³å…·ä½“çš„ä»£ç å®ç°ï¼Œè¯·å‚é˜…ä»¥ä¸‹æ–‡æ¡£ï¼š

### [ğŸ‘‰ å‰ç«¯å®ç°æ–‡æ¡£ (Flutter)](../frontend/doc/revenuecat_subscription.md)

åŒ…å«ï¼š

- Flutter ä¾èµ–ä¸ SDK é…ç½®
- RevenueCat æœåŠ¡é‡æ„ä»£ç 
- Paywall é¡µé¢å®ç°
- å‰ç«¯æµ‹è¯•æŒ‡å—

### [ğŸ‘‰ åç«¯å®ç°æ–‡æ¡£ (Cloudflare Worker + Supabase)](../backend/docs/revenuecat_subscription.md)

åŒ…å«ï¼š

- æ•°æ®åº“ Schema è®¾è®¡
- Webhook å¤„ç†é€»è¾‘
- è‡ªåŠ¨æ¸…ç†ä»»åŠ¡ (Cron Triggers)
- åç«¯æµ‹è¯•æŒ‡å—
- å®‰å…¨æ€§é…ç½®

---

## 4. App Store / Google Play é…ç½®

### 4.1 App Store Connect

1. **åˆ›å»º App å†…è´­ä¹°é¡¹ç›®**
   - ç±»å‹: è‡ªåŠ¨ç»­è®¢è®¢é˜…
   - äº§å“ ID: å¯¹åº”ä¸Šè¿° Product IDs
   - è®¢é˜…ç»„: TriTalk Subscriptions

2. **é…ç½®è®¢é˜…æ—¶é•¿å’Œä»·æ ¼**
   - Plus Monthly: $6.8/æœˆ
   - Plus Yearly: $49/å¹´
   - Pro Monthly: $13.8/æœˆ
   - Pro Yearly: $99/å¹´

3. **App Store Connect API Key**
   - ç”¨äº RevenueCat éªŒè¯è´­ä¹°

### 4.2 Google Play Console

1. **åˆ›å»ºè®¢é˜…äº§å“**
   - è·¯å¾„: Monetization â†’ Subscriptions
   - åˆ›å»ºè®¢é˜…: tritalkplus, tritalkpro
   - åˆ›å»ºåŸºç¡€æ–¹æ¡ˆ: monthly, yearly

2. **é…ç½® Service Account**
   - ç”¨äº RevenueCat éªŒè¯è´­ä¹°
   - æˆäºˆ "View financial data" æƒé™

---

## 5. æµ‹è¯•ç­–ç•¥

### 5.1 æ²™ç›’æµ‹è¯•

- [ ] iOS Sandbox è´¦å·è´­ä¹°æµ‹è¯•
- [ ] Android æµ‹è¯•è½¨é“è´­ä¹°æµ‹è¯•
- [ ] è´­ä¹° â†’ å–æ¶ˆ â†’ è¿‡æœŸæµç¨‹
- [ ] æ¢å¤è´­ä¹°åŠŸèƒ½
- [ ] å‡çº§/é™çº§æµ‹è¯•
- [ ] å®½é™æœŸæµ‹è¯• (æš‚æœªå¯ç”¨)

_æ›´å¤šç‰¹å®šå¹³å°çš„æµ‹è¯•é¡¹ï¼Œè¯·å‚è€ƒ[å‰ç«¯](../frontend/doc/revenuecat_subscription.md#3-å‰ç«¯æµ‹è¯•)å’Œ[åç«¯](../backend/docs/revenuecat_subscription.md#3-webhook-æµ‹è¯•)æ–‡æ¡£ã€‚_

---

## 6. ç›‘æ§ä¸å‘Šè­¦

### 6.1 RevenueCat Dashboard

- è®¢é˜…æ”¶å…¥è¿½è¸ª
- æµå¤±ç‡åˆ†æ
- è¯•ç”¨è½¬åŒ–ç‡

### 6.2 æ—¥å¿—ç›‘æ§

- Webhook å¤„ç†é”™è¯¯
- è´­ä¹°å¤±è´¥
- è®¢é˜…çŠ¶æ€å¼‚å¸¸

### 6.3 å…³é”®æŒ‡æ ‡

- MRR (æœˆåº¦ç»å¸¸æ€§æ”¶å…¥)
- Churn Rate (æµå¤±ç‡)
- Trial-to-Paid Conversion

---

## 7. å®æ–½æ­¥éª¤

è¯¦æƒ…è¯·å‚è€ƒå„è‡ªåˆ†é¡¹æ–‡æ¡£ï¼Œæ€»ä½“æµç¨‹å¦‚ä¸‹ï¼š

### Phase 1: åŸºç¡€è®¾æ–½ (1-2 å¤©)

- åˆ›å»º RevenueCat é¡¹ç›®å¹¶é…ç½®
- é…ç½® App Store Connect å’Œ Google Play Console
- åˆ›å»ºæ•°æ®åº“è¡¨ ([Backend Doc](../backend/docs/revenuecat_subscription.md))
- æ·»åŠ åç«¯ Webhook å¤„ç† ([Backend Doc](../backend/docs/revenuecat_subscription.md))

### Phase 2: å‰ç«¯å®ç° (2-3 å¤©)

- é›†æˆ RevenueCat SDK ([Frontend Doc](../frontend/doc/revenuecat_subscription.md))
- é‡æ„ RevenueCatService ([Frontend Doc](../frontend/doc/revenuecat_subscription.md))
- é‡æ„ PaywallScreen ([Frontend Doc](../frontend/doc/revenuecat_subscription.md))
- æ·»åŠ è®¢é˜…çŠ¶æ€ UI

### Phase 3: æµ‹è¯•ä¸ä¼˜åŒ– (2-3 å¤©)

- Sandbox è´­ä¹°æµ‹è¯•
- Webhook é›†æˆæµ‹è¯•
- é”™è¯¯å¤„ç†å®Œå–„
- æ€§èƒ½ä¼˜åŒ–

### Phase 4: ä¸Šçº¿ (1 å¤©)

- æäº¤ App å®¡æ ¸
- é…ç½®ç”Ÿäº§ç¯å¢ƒ
- ç›‘æ§è®¾ç½®

---

## é™„å½•: å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆé€‰æ‹© RevenueCat è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ StoreKit/Billingï¼Ÿ

A: RevenueCat æä¾›ç»Ÿä¸€çš„ APIï¼Œç®€åŒ–è·¨å¹³å°å¼€å‘ï¼Œè‡ªåŠ¨å¤„ç†æ”¶æ®éªŒè¯ï¼Œæä¾›å¼ºå¤§çš„åˆ†æåŠŸèƒ½ã€‚

### Q: å¦‚ä½•å¤„ç†ç”¨æˆ·åˆ‡æ¢è®¾å¤‡ï¼Ÿ

A: RevenueCat é€šè¿‡ app_user_idï¼ˆæ˜ å°„åˆ° Supabase user IDï¼‰è‡ªåŠ¨åŒæ­¥è®¢é˜…çŠ¶æ€ã€‚

### Q: Webhook å¤±è´¥ä¼šæ€æ ·ï¼Ÿ

A: RevenueCat ä¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„ webhookã€‚åŒæ—¶ï¼Œå®¢æˆ·ç«¯å®šæœŸåˆ·æ–°çŠ¶æ€å¯ä»¥ä½œä¸ºå¤‡ä»½ã€‚

### Q: å¦‚ä½•å¤„ç†é€€æ¬¾ï¼Ÿ

A: RevenueCat ä¼šå‘é€ REFUND äº‹ä»¶ï¼ˆå¦‚æœé…ç½®ï¼‰ï¼Œåç«¯æ”¶åˆ°åæ›´æ–°è®¢é˜…çŠ¶æ€ä¸º freeã€‚
